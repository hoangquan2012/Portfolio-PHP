const ZYK_DATA_KEY="zyk",zykKeys={ctrlDown:!1,shiftDown:!1,altDown:!1,ctrl:17,cmd:91,alt:18,space:32,shift:16,escape:27,g:71,z:90,a:65,c:67,v:86,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,delete:46,backSpace:8},zykVar={calendarLang:{en:{today:"Today",daysOfWeek:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysOfWeekShort:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysOfWeekLetters:["M","T","W","T","F","S","S"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],views:{year:"Year",month:"Month",week:"Week",day:"Day"}},vi:{today:"Hôm nay",daysOfWeek:["Thứ hai","Thứ ba","Thứ tư","Thứ năm","Thứ sáu","Thứ bảy","Chủ nhật"],daysOfWeekShort:["Th2","Th3","Th4","Th5","Th6","Th7","CN"],daysOfWeekLetters:["Th2","Th3","Th4","Th5","Th6","Th7","CN"],months:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],monthsShort:["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10","T11","12"],views:{year:"Năm",month:"Tháng",week:"Tuần",day:"Ngày"}}},basicLang:{next:lang["000100_12"],prev:lang["000100_13"]},secToMinFormat:{DEFAULT:0,TEXT:1},fileTypes:{VIDEO:1,YOUTUBE:2}},zykUtil={typeOf:e=>({}).toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase(),configSpread(e){let t=[];for(let e=0;e<arguments.length;e++){let n=null!=arguments[e]?arguments[e]:{};"object"==this.typeOf(n)&&t.push(n)}return e=t.reduce(function(e,t){return Object.assign(e,t)},{}),e},bodyBlock(e){e?($("body").removeClass("overflow-on"),$("body").addClass("overflow-off")):($("body").removeClass("overflow-off"),$("body").addClass("overflow-on"))},convertSlug(e){let t=e.toLowerCase()+"";return t=t.replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi,"a"),t=t.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi,"e"),t=t.replace(/i|í|ì|ỉ|ĩ|ị/gi,"i"),t=t.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi,"o"),t=t.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi,"u"),t=t.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi,"y"),t=t.replace(/đ/gi,"d"),t=t.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi,""),t=t.replace(/ /gi,"-"),t=t.replace(/\-\-\-\-\-/gi,"-"),t=t.replace(/\-\-\-\-/gi,"-"),t=t.replace(/\-\-\-/gi,"-"),t=t.replace(/\-\-/gi,"-"),t="@"+t+"@",t=t.replace(/\@\-|\-\@|\@/gi,""),t},checkPopper(){let e=!1;if("object"==typeof Popper&&(e=!0),!e)throw new TypeError("Require Popper js");return e},replaceAll:(e,t,n)=>e.split(t).join(n),buildUrl(e,t,n){let i=encodeURIComponent(t),a=encodeURIComponent(n),l=e.split("?")[0],r=i+"="+a,o="?"+r;if(void 0===e.split("?")[1]?urlQueryString="":urlQueryString="?"+e.split("?")[1],urlQueryString){let e=new RegExp("([?&])"+i+"[^&]*"),t=new RegExp("([?&])"+i+"=[^&;]+[&;]?");null==a||""===a?(o=urlQueryString.replace(t,"$1"),o=o.replace(/[&;]$/,"")):o=null!==urlQueryString.match(e)?urlQueryString.replace(e,"$1"+r):""==urlQueryString?"?"+r:urlQueryString+"&"+r}return o="?"===o?"":o,l+o},secToMin(e,t=zykVar.secToMinFormat.DEFAULT){let n=Math.floor(e/3600);0==Math.floor(n/10)&&(n="0"+n),e%=3600;let i=Math.floor(e/60);if(e=Math.round(e%60),0==Math.floor(i/10)&&(i="0"+i),0==Math.floor(e/10)&&(e="0"+e),t==SEC_TO_MIN_FORMAT.DEFAULT)return n+":"+i+":"+e;if(t==SEC_TO_MIN_FORMAT.TEXT){let t=lang["000200_189"];return 0==n&&(t=t.substring(9)),t=t.replaceAll("!!HOUR!!",n),t=t.replaceAll("!!MIN!!",i),t=t.replaceAll("!!SEC!!",e),t}},convertHEXToRGB(e){let t={r:0,g:0,b:0};var n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(n,function(e,t,n,i){return t+t+n+n+i+i});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i&&(t={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}),t},convertHEXToRGBA(e,t){let n={r:0,g:0,b:0,a:1};var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(i,function(e,t,n,i){return t+t+n+n+i+i});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a&&(n={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16),a:1-t}),n},convertRGBToHEX(e,t,n){let i=[e,t,n],a="#";for(let e=0;e<3;e++){let t=i[e].toString(16);t=1==t.length?"0"+t:t,a+=t}return a}};document.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(e){e.keyCode!=zykKeys.ctrl&&e.keyCode!=zykKeys.cmd||(zykKeys.ctrlDown=!0),e.keyCode==zykKeys.shift&&(zykKeys.shiftDown=!0),e.keyCode==zykKeys.alt&&(zykKeys.altDown=!0)}),document.addEventListener("keyup",function(e){e.keyCode==zykKeys.shift&&(zykKeys.shiftDown=!1),e.keyCode!=zykKeys.ctrl&&e.keyCode!=zykKeys.cmd||(zykKeys.ctrlDown=!1),e.keyCode==zykKeys.alt&&(zykKeys.altDown=!1),e.keyCode,zykKeys.esc})});class ZykCalendar{constructor(e,t){let n={view:"month",lang:"en",bordered:!1,header:{today:{class:!1,callback:!1},"date-control":{class:!1,callback:!1},"switch-view":{class:!1,callback:!1,layout:"group"}},body:{showMoreDates:!0},date:null,month:null,year:null,boxDayRatio:"auto",btnControlClass:"btn-outline-default",btnTodayClass:"btn-primary",btnSwitchView:"btn-outline-default",btnSwitchViewActive:"btn-primary",events:{},eventOnClick:!1,eventOnClickNext:!1,eventOnClickPrev:!1,eventOnClickToday:!1};this.config={...n,...t},this.date=null!=this.config.date?this.config.date:this.getDate(),this.month=null!=this.config.month?this.config.month:this.getMonth(),this.year=null!=this.config.year?this.config.year:this.getYear(),this.currentDate=moment().date(),this.currentMonth=moment().month(),this.currentYear=moment().year(),this.element=e,this.prepare()}getDate(){return moment().date()}getMonth(){return moment().month()}getDaysInMonth(e=!1,t=!1){const n=this;e||(e=n.month+1),t||(t=n.year);let i=`${t}-${e>10?e:"0"+e}`;return moment(i).daysInMonth()}getFirstDayDate(e,t){let n=new Date(t,e).getDay();return 0==n&&(n=7),n}getPrevMonth(){const e=this;e.month--,e.month<0&&(e.month=11,e.year--)}getNextMonth(){const e=this;e.month++,e.month>11&&(e.month=0,e.year++)}getYear(){return moment().year()}getConfig(){return this.config.boxDayRatio<=0&&(this.config.boxDayRatio=1),this.config}prepare(){const e=this;if("undefined"==typeof moment)throw new TypeError("Moment js is missing!");if("undefined"==typeof Popper)throw new TypeError("Popper js is missing!");e.render()}checkToday(){const e=this;let t=!1;return e.year==e.currentYear&&e.month==e.currentMonth&&e.date==e.currentDate&&(t=!0),t}render(){const e=this;let t=e.getConfig();$(e.element).empty(),t.bordered&&$(e).addClass("zyk-calendar-bordered"),t.view&&$(e.element).addClass(`zyk-calendar-${t.view}`),"single-month"==t.view&&(t.header={},t.header.btnNext={},t.header.btnShowDate={},t.header.btnPrev={}),Object.keys(t.header).length>0&&$(e.element).append(e.getCalendarHeader()),$(e.element).append(e.getCalendarBody()),e.setTableBodySize()}getCalendarHeader(){const e=this;let t=e.getConfig(),n=$('<div class="zyk-calendar-header"></div>');switch(t.view){case"single-month":let i=$(`\n                    <button class="btn ${t.btnControlClass} btn-zyk-calendar-control btn-zyk-calendar-prev" type="button">\n                        <i class="elo el-caret-left"></i>\n                    </button>\n                `),a=$(`\n                    <button class="btn ${t.btnControlClass} btn-zyk-calendar-control btn-zyk-calendar-next" type="button">\n                        <i class="elo el-caret-right"></i>\n                    </button>\n                `),l=$(`\n                    <button class="btn btn-zyk-calendar-show-date" type="button">\n                        ${zykVar.calendarLang[t.lang].months[e.month]} - ${e.year}\n                    </button>\n                `);i.unbind().on("click",function(){e.getPrevMonth();let n={year:e.year,month:e.month,date:null};t.eventOnClickPrev&&t.eventOnClickPrev(n),e.render()}),a.unbind().on("click",function(){e.getNextMonth();let n={year:e.year,month:e.month,date:null};t.eventOnClickNext&&t.eventOnClickNext(n),e.render()}),n.append(i),n.append(l),n.append(a);break;case"month":case"week":case"year":n=e.getCommonCalendarHeader()}return n}getCommonCalendarHeader(){const e=this;let t=e.getConfig(),n=$('<div class="zyk-calendar-header"></div>'),i=$('<div class="zyk-calendar-header-left"></div>'),a=$('<div class="zyk-calendar-header-right"></div>');return $.each(t.header,(n,l)=>{switch(n){case"today":let r="btn-outline-default";l.class&&(r=l.class),e.checkToday()&&(r="btn-primary");let o=$(`\n                        <button class="btn ${r} btn-zyk-calendar-control btn-zyk-calendar-today" type="button">\n                            ${zykVar.calendarLang[t.lang].today}\n                        </button>\n                    `);o.unbind().on("click",function(){l.callback&&l.callback()}),i.append(o);break;case"date-control":let s=$('<div class="btn-group btn-group-sm"></div>'),d="";l.class&&(d=l.class);let c=$(`\n                        <button class="btn ${d} btn-zyk-calendar-control btn-zyk-calendar-prev" type="button">\n                            <i class="elo el-caret-left"></i>\n                        </button>\n                    `),E=$(`\n                        <button class="btn ${d} btn-zyk-calendar-control btn-zyk-calendar-next" type="button">\n                            <i class="elo el-caret-right"></i>\n                        </button>\n                    `),p=$(`\n                        <button class="btn btn-zyk-calendar-show-date" type="button">\n                            ${zykVar.calendarLang[t.lang].months[e.month]} - ${e.year}\n                        </button>\n                    `);c.unbind().on("click",function(){e.getPrevMonth();let n={year:e.year,month:e.month,date:null};t.eventOnClickPrev&&t.eventOnClickPrev(n),e.render()}),E.unbind().on("click",function(){e.getNextMonth();let n={year:e.year,month:e.month,date:null};t.eventOnClickNext&&t.eventOnClickNext(n),e.render()}),s.append(c),s.append(E),i.append(s),i.append(p);break;case"switch-view":l.layout||(l.layout="group");let u=zykVar.calendarLang[t.lang].views;switch(l.layout){case"group":let n=$('<div class="btn-group btn-group-sm"></div>');for(let i=0;i<Object.keys(u).length;i++){let a=Object.keys(u)[i],l=$(`\n                                    <button class="btn ${a==t.view?"btn-primary":"btn-outline-default"}" type="button">\n                                        ${u[a]}\n                                    </button>\n                                `);l.unbind().on("click",function(){t.view=a,e.render()}),n.append(l)}a.append(n);break;case"dropdown":let i=$(`\n                                <div class="dropdown">\n                                    <button class="btn btn-outline-default dropdown-toggle" data-bs-toggle="dropdown" type="button">\n                                        ${zykVar.calendarLang[t.lang].views[t.view]}\n                                    </button>\n                                </div>\n                            `),r=$('<div class="dropdown-menu"></div>');for(let n=0;n<Object.keys(u).length;n++){let i=Object.keys(u)[n],a=$(`\n                                    <a href="#" class="dropdown-item" data-view="${i}">\n                                        ${u[i]}\n                                    </div>\n                                `);a.unbind().on("click",function(n){n.preventDefault(),t.view=i,e.render()}),r.append(a)}i.append(r),a.append(i)}}}),n.append(i),n.append(a),n}getCalendarBody(){const e=this;let t=$('<div class="zyk-calendar-body"></div>');return t.append(e.getCalendarTable()),t}getCalendarTable(){const e=this;let t=$('<div class="zyk-calendar-table"></div>');return t.append(e.getCalendarTableHeader()),t.append(e.getCalendarTableBody()),t}getCalendarTableHeader(){const e=this;let t,n=e.getConfig(),i=$('<div class="zyk-calendar-table-header"></div>');switch(n.view){case"single-month":case"month":for(let e=0;e<7;e++)t=$('<div class="zyk-calendar-table-header-item"></div>'),t.append(`\n                        <p class="zyk-calendar-date-of-week">\n                            ${zykVar.calendarLang[n.lang].daysOfWeekShort[e]}\n                        </p>\n                    `),i.append(t)}return i}getCalendarTableBody(){const e=this;let t,n=e.getConfig(),i=$('<div class="zyk-calendar-table-body"></div>');switch(n.view){case"single-month":for(let n=0;n<e.getFirstDayDate(e.month,e.year)-1;n++)t=$('<div class="zyk-calendar-table-day"></div>'),i.append(t);for(let a=0;a<e.getDaysInMonth();a++){t=$('<div class="zyk-calendar-table-day"></div>'),e.year==e.currentYear&&e.month==e.currentMonth&&a+1==e.currentDate&&t.addClass("zyk-calendar-today");let l=$(`\n                        <a href="#" class="zyk-calendar-day">\n                            ${a+1}\n                        </a>\n                    `);t.append(l);let r=`${e.year}-${e.month+1>=10?e.month+1:"0"+(e.month+1)}-${a+1>=10?a+1:"0"+(a+1)}`;n.events[r]?(t.data("event",n.events[r]),t.addClass("zyk-calendar-day-has-event"),t.append('<span class="circle"></span>')):t.data("event",{date:r}),l.unbind().on("click",function(){i.find(".zyk-calendar-table-day").removeClass("zyk-calendar-table-day-selected"),$(this).parent().hasClass("zyk-calendar-today")||$(this).parent().addClass("zyk-calendar-table-day-selected"),n.eventOnClick&&$(this).parent().data("event")&&n.eventOnClick($(this).parent().data("event"))}),i.append(t)}break;case"month":if(n.body.showMoreDates){let t=e.month-1,n=e.year;t<0&&(t=11,n=e.year-1),console.log(t,n);let i=e.getDaysInMonth(t,n);console.log(i)}for(let n=0;n<e.getFirstDayDate(e.month,e.year)-1;n++)t=$('<div class="zyk-calendar-table-day"></div>'),i.append(t);for(let a=0;a<e.getDaysInMonth();a++){t=$('<div class="zyk-calendar-table-day"></div>'),e.year==e.currentYear&&e.month==e.currentMonth&&a+1==e.currentDate&&t.addClass("zyk-calendar-today");let l=$(`\n                        <a href="#" class="zyk-calendar-day">\n                            ${a+1}\n                        </a>\n                    `);t.append(l);let r=`${e.year}-${e.month+1>=10?e.month+1:"0"+(e.month+1)}-${a+1>=10?a+1:"0"+(a+1)}`;n.events[r]?(t.data("event",n.events[r]),t.addClass("zyk-calendar-day-has-event"),t.append('<span class="circle"></span>')):t.data("event",{date:r}),l.unbind().on("click",function(){i.find(".zyk-calendar-table-day").removeClass("zyk-calendar-table-day-selected"),$(this).parent().hasClass("zyk-calendar-today")||$(this).parent().addClass("zyk-calendar-table-day-selected"),n.eventOnClick&&$(this).parent().data("event")&&n.eventOnClick($(this).parent().data("event"))}),i.append(t)}}return i}setTableBodySize(){const e=this;let t=e.getConfig();"auto"!=t.boxDayRatio&&$(e.element).find(".zyk-calendar-table-day").each(function(){$(this).css({height:$(this).width()/t.boxDayRatio})})}}class Calendar{constructor(e,t){let n={view:"month",lang:"en",bordered:!1,header:{controls:["today"],title:!0,views:["month","week","day"]},body:{tableHeader:{type:"daysOfWeek"},tableBody:{disablePast:!1}},buttonClass:{default:"btn btn-sm btn-default",active:"btn btn-sm btn-primary"},icons:{prev:"els el-sm el-caret-left",next:"els el-sm el-caret-right"},dayRatio:.5,dayFormat:"d/m/y",date:null,month:null,year:null,events:[],eventOnClick:!1,eventOnClickNext:!1,eventOnClickPrev:!1,eventOnClickToday:!1};this.config={...n,...t},this.date=new Date,this.currentDate=this.getDate(),this.currentMonth=this.getMonth(),this.currentYear=this.getYear(),this.contentText=zykVar.calendarLang[this.config.lang],this.target=e,this.render(e)}render(e){const t=this;$(e).html(""),t.config.bordered&&$(e).addClass("calendar-bordered"),t.config.header&&""!=t.config.header&&($(e).append('<div class="calendar-header"></div>'),$(e).find(".calendar-header").html(t.getCalendarHeader()));let n="";"week"==this.config.view?n="calendar-body-week":"day"==this.config.view&&(n="calendar-body-day"),$(e).append(`<div class="calendar-body ${n} overflow-y"></div>`),$(e).find(".calendar-body").html(t.getCalendarBody()),this.setTableColSize(),this.getEvents(),this.initActions()}getYear(){let e=null==this.config.year?this.date.getFullYear():this.config.year;return e}getPrevYear(){let e=this.currentYear,t=e-1;return t}getNextYear(){let e=this.currentYear,t=e+1;return t}getMonth(){let e=null==this.config.month?this.date.getMonth():this.config.month;return e}getPrevMonth(){let e,t=this.currentMonth;return t>0?(e=t-1,e):(e=11,e)}getNextMonth(){let e,t=this.currentMonth;return t<11?(e=t+1,e):(e=0,e)}getDate(){let e=null==this.config.date?this.date.getDate():this.config.date;return e}getToday(e,t,n){return e==this.date.getDate()&&t==this.date.getMonth()&&n==this.date.getFullYear()}getDaysInMonth(e,t){return 32-new Date(t,e,32).getDate()}getDaysInWeek(e=this.currentDate,t=this.currentMonth,n=this.currentYear){const i=this;let a,l=[];e>i.getDaysInMonth(t,n)&&(e-=i.getDaysInMonth(t,n)),a=new Date(`${n}-${t+1}-${e}`).getDay()-1<0?6:new Date(`${n}-${t+1}-${e}`).getDay()-1;for(let r=0;r<7;r++){let o=e-a;r+o>i.getDaysInMonth(t,n)?l[r]=r+o-i.getDaysInMonth(t,n):l[r]=r+o}return l}getFirstDay(e,t){return new Date(t,e).getDay()}getCalendarHeader(){const e=this;let t="";return e.config.header&&""!=e.config.header&&$.each(e.config.header,n=>{t+=`\n                    <div class="calendar-header-${n}">\n                        ${e.getCalendarHeaderElements(n)}\n                    </div>\n                `}),t}getCalendarHeaderElements(e){const t=this;let n="";if("controls"==e){if(!t.config.header||""==t.config.header)throw new TypeError("Calendar configs header controls failed!");t.config.header.controls.indexOf("today")>-1&&(n+=`\n                        <button class="${t.config.buttonClass.default} btn-calendar-today" type="button">\n                            ${t.contentText.today}\n                        </button>\n                    `)}else if("title"==e){if(null!=t.date||t.config.header.title)if("month"==t.config.view){if(n+=`\n                        <button class="${t.config.buttonClass.default} btn-calendar-prev" type="button">\n                            <i class="${t.config.icons.prev}"></i>\n                        </button>\n                    `,"month"==t.config.view){let e="";$.each(t.contentText.monthsShort,function(n,i){e+=`\n                                <button class="${t.config.buttonClass.default} btn-calendar-monthpicker" data-month="${n}" type="button">\n                                    ${i}\n                                </button>\n                            `}),n+=`\n                            <div class="dropdown">\n                                <button class="${t.config.buttonClass.default}" data-toggle="dropdown" data-placement="bottom" type="button">\n                                    ${t.contentText.months[t.currentMonth]} ${t.currentYear}\n                                </button>\n\n                                <div class="dropdown-menu">\n                                    <div class="calendar-monthpicker-wrapper">\n                                        <div class="calendar-monthpicker-header">\n                                            <button class="${t.config.buttonClass.default} btn-calendar-monthpicker-year-prev" type="button">\n                                                <i class="els el-sm el-caret-left"></i>\n                                            </button>\n\n                                            <h6 class="subtitle-md">\n                                                ${t.currentYear}\n                                            </h6>\n\n                                            <button class="${t.config.buttonClass.default} btn-calendar-monthpicker-year-next" type="button">\n                                                <i class="els el-sm el-caret-right"></i>\n                                            </button>\n                                        </div>\n                                        <div class="calendar-monthpicker-body">\n                                            ${e}\n                                        </div>\n                                    </div>\n\n                                    <input type="hidden" value="${t.currentMonth}">\n                                    <input type="hidden" value="${t.currentYear}">\n                                </div>\n                            </div>\n                        `}else n+=`\n                            <h6>\n                                ${t.contentText.months[t.currentMonth]} ${t.currentYear}\n                            </h6>\n                        `;n+=`\n                        <button class="${t.config.buttonClass.default} btn-calendar-next" type="button">\n                            <i class="${t.config.icons.next}"></i>\n                        </button>\n                    `}else"week"==t.config.view&&("d/m/y"==t.config.dayFormat?n+=`\n                            <h6>${t.getDaysInWeek()[0]} - ${t.getDaysInWeek()[6]} ${t.contentText.months[t.currentMonth]} ${t.currentYear}</h6>\n                        `:"m/d/y"==t.config.dayFormat?n+=`\n                            <h6>${t.contentText.months[t.currentMonth]} ${t.getDaysInWeek()[0]} - ${t.getDaysInWeek()[6]}, ${t.currentYear}</h6>\n                        `:(n+=`\n                            <h6>${t.getDaysInWeek()[0]} - ${t.getDaysInWeek()[6]} ${t.contentText.months[t.currentMonth]} ${t.currentYear}</h6>\n                        `,console.log("Calendar Day Format isn't not supported! Calendar Day Format changed into 'd/m/y '")));else if(null==t.date)throw new TypeError("Can't get Date from your computer!")}else if("views"==e){let e="";t.config.header.views&&""!=t.config.header.views&&$.each(t.config.header.views,(n,i)=>{t.config.header.views.indexOf(i)>-1&&(e+=`<button class="${t.config.view==i?t.config.buttonClass.active:t.config.buttonClass.default} btn-calendar-view" type="button" data-view="${i}">${i}</button>`)}),n+=`\n                <div class="btn-group">\n                    ${e}\n                </div>\n            `}return n}getCalendarBody(){const e=this;let t="",n="",i="";if("month"==this.config.view){if(!(Object.keys(e.contentText).indexOf(e.config.body.tableHeader.type)>-1))throw new TypeError("There is no type of Calendar Table Header Type");$.each(e.contentText[e.config.body.tableHeader.type],(t,i)=>{n+=e.getTableCol(i,"","",!1)}),t+=e.getTableRow(n)}else"week"==this.config.view?(n+=e.getTableCol("","","",!1,"calendar-table-col-hour"),$.each(e.contentText[e.config.body.tableHeader.type],(t,i)=>{n+=e.getTableCol(i,"","",!1,"calendar-table-col-day")}),n+=e.getTableCol("","","",!1,"calendar-table-col-hour"),$.each(e.getDaysInWeek(),function(t,i){n+=e.getTableCol(i,e.currentMonth,e.currentYear,!1)}),t+=e.getTableRow(n)):this.config.view;i+=e.getTable(e.config.view);let a=`\n            <div class="calendar-table">\n                <div class="calendar-table-header">${t}</div>\n                <div class="calendar-table-body">${i}</div>\n            </div>\n        `;return a}getTable(e,t=this.currentMonth,n=this.currentYear){const i=this;let a="";if("month"==e){let e,l=1;e=i.getFirstDay(t,n)-1<0?6:i.getFirstDay(t,n)-1;for(let r=0;r<6;r++){let o="";for(let a=0;a<7;a++)if(0==r&&a<e){let l;0==t?(l=i.getDaysInMonth(i.getPrevMonth(),i.getPrevYear()),o+=i.getTableCol(l+-1*e+1+a,i.getPrevMonth(),i.getPrevYear())):(l=i.getDaysInMonth(i.getPrevMonth(),n),o+=i.getTableCol(l+-1*e+1+a,i.getPrevMonth(),n)),l--}else r>0&&l>i.getDaysInMonth(t,n)?(o+=11==t?i.getTableCol(l-i.getDaysInMonth(t,n),i.getNextMonth(),i.getNextYear()):i.getTableCol(l-i.getDaysInMonth(t,n),i.getNextMonth(),n),l++):(o+=i.getTableCol(l,t,n),l++);a+=i.getTableRow(o)}}else if("week"==e)for(let e=0;e<24;e++){let t,n="";t=e<10?"0"+e+":00":e+":00",n+=i.getTableCol(t,i.currentMonth,"",!1,"calendar-table-col-hour");for(let e=0;e<7;e++)n+=i.getTableCol("",i.currentMonth,"");a+=i.getTableRow(n)}return a}getTableRow(e){return`\n            <div class="calendar-table-row">${e}</div>\n        `}getTableCol(e,t,n,i=!0,a=""){const l=this;return`\n            <div class = "calendar-table-col ${a} ${i&&t!=l.currentMonth?"calendar-table-col-disabled":""}">\n                ${(()=>i?`\n                            <a href="#" class="calendar-table-day ${l.getToday(e,t,n)?"calendar-table-today":""}" data-calendar-day="${n}-${t+1>=10?t+1:"0"+(t+1)}-${e>=10?e:"0"+e}">\n                                <span class="day-text">${e}</span>\n                            </a>\n                        `:`\n                            <span class="${l.getToday(e,t,n)?"calendar-span-today":""}" data-calendar-day="${n}-${t+1>=10?t+1:"0"+(t+1)}-${e>=10?e:"0"+e}">\n                                ${e}\n                            </span>\n                        `)()}\n            </div>\n        `}setTableColSize(){const e=this;$(this.target).find(".calendar-table-day").each(function(){"month"==e.config.view?"auto"!=e.config.dayRatio&&$(this).css({height:$(this).width()*e.config.dayRatio+"px"}):"week"==e.config.view&&$(this).css({height:1*$(this).width()+"px"})})}getEvents(){const e=this;let t=Object.keys(e.config.events),n=t.length;n>0&&$(e.target).find(".calendar-table-day").each(function(){let n=$(this).data("calendar-day");if(t.indexOf(n)>-1){$(this).append('\n                        <span class="day-events"></span>\n                    ');for(let t=0;t<Object.keys(e.config.events[n]).length;t++)$(this).find("span.day-events").append(`\n                            <i>\n                                ${Object.keys(e.config.events[n][t]).length}\n                            </i>\n                        `)}}),$(e.target).find(".calendar-table-day").each(function(){$(this).unbind().on("click",function(){e.config.eventOnClick&&e.config.eventOnClick(this)})})}initActions(){this.actionHeader()}actionHeader(){this.getCalendarNext(),this.getCalendarPrev(),this.getCalendarToday(),this.changeCalendarView(),this.monthPicker()}getCalendarNext(){const e=this;$(this.target).find(".btn-calendar-next").unbind().on("click",function(){"month"==e.config.view?(11==e.currentMonth&&(e.currentYear=e.getNextYear(),e.config.year=e.currentYear),e.currentMonth=e.getNextMonth(),e.config.month=e.currentMonth):"week"==e.config.view&&(e.currentDate+7>e.getDaysInMonth(e.currentMonth,e.currentYear)?e.currentDate=e.currentDate+7-e.getDaysInMonth(e.currentMonth,e.currentYear):e.currentDate=e.currentDate+7),void 0===e.currentDate&&(e.currentDate=""),e.config.eventOnClickNext&&e.config.eventOnClickNext(e.config),e.render(e.target)})}getCalendarPrev(){const e=this;$(this.target).find(".btn-calendar-prev").unbind().on("click",function(){"month"==e.config.view&&(0==e.currentMonth&&(e.currentYear=e.getPrevYear(),e.config.year=e.currentYear),e.currentMonth=e.getPrevMonth(),e.config.month=e.currentMonth),void 0===e.currentDate&&(e.currentDate=""),e.config.eventOnClickPrev&&e.config.eventOnClickPrev(e.config),e.render(e.target)})}getCalendarToday(){const e=this;$(e.target).find(".btn-calendar-today").unbind().on("click",function(){"month"==e.config.view&&(e.currentMonth=e.date.getMonth(),e.currentYear=e.date.getFullYear(),e.config.month=e.currentMonth,e.config.year=e.currentYear),e.config.eventOnClickToday&&e.config.eventOnClickToday(e.config),e.render(e.target)})}changeCalendarView(){const e=this;$(e.target).find(".btn-calendar-view").unbind().on("click",function(){let t=$(this).data("view");e.config.view=t,e.render(e.target)})}monthPicker(){const e=this;let t=e.currentYear;$(e.target).find(".btn-calendar-monthpicker-year-next").unbind().on("click",function(e){e.preventDefault(),e.stopPropagation(),t++,$(this).siblings("h6").text(t)}),$(e.target).find(".btn-calendar-monthpicker-year-prev").unbind().on("click",function(e){e.preventDefault(),e.stopPropagation(),t--,$(this).siblings("h6").text(t)}),$(e.target).find(".btn-calendar-monthpicker").unbind().on("click",function(n){n.preventDefault(),n.stopPropagation(),e.currentMonth=$(this).data("month"),e.currentYear=t,e.render(e.target)})}}class ZykTimeliner{constructor(e){let t={labels:{default:"Timeliner",close:"Close timeliner",collapse:"Collapse timerliner",addLayer:"Add layer group",play:"Play",stop:"Stop",start:"Start time:",end:"End time:",duration:"Duration:",controlPreview:"Show preview"},classes:{timelinerCollapsed:"timeliner-collapsed"},timeline:{classes:["timeline-025","timeline-05","timeline-1","timeline-5","timeline-30"],scales:[4,2,1,.2,1/30],scaleIndex:2,scale:1,duration:60,step:10,pixelPerSecond:160,defaultPixelPerSecond:160,currentTime:0,isPlaying:!1,offsetLeft:0},events:{onPrepareConfig:!1,onBeforeRender:!1,onRendered:!1,onPlayTimeline:!1,onPlayingTimeline:!1,onPauseTimeline:!1,onStopTimeline:!1,onAddLayerGroup:!1,onEditLayerGroup:!1,onRemoveLayerGroup:!1,onAddLayer:!1,onEditLayer:!1,onRemoveLayer:!1,onDblClickFrame:!1,onUpdateGroupFrame:!1,onUpdateFrame:!1,onShown:!1,onStopSortLayerGroup:!1,onStopSortLayerItem:!1,onRequestPlayAudioUrl:!1,onRequestPlayVideoUrl:!1,onSendMessage:!1,onAddMediaCondition:!1,onRemoveMediaCondition:!1,onSelectMediaCondition:!1,onCheckShowPreview:!1},layers:{version:1,data:{}},requestAnimation:null};this.defaultOptions=t,this.options=e,this.config={},this.element=null,this.isShown=!1,this.openedGroup=[],this.activeGroup=null,this.activeLayer=[],this.audio=null,this.layerPlayingAudio=null,this.video=null,this.videoType=null,this.layerPlayingVideo=null,this.getConfig()}getConfig(){const e=this;if(!eldraw)throw new Error("eldraw is missing!");let t=e.defaultOptions;if(Object.keys(e.options).length>0)for(let n in e.options)t[n]&&(t[n]={...e.defaultOptions[n],...e.options[n]});if(e.config=t,0==Object.keys(e.config.layers.data).length){let t=eldraw.util.randomId();e.config.layers.data[t]={index:1,id:t,label:lang["010205_76"],children:[]}}e.config.events.onPrepareConfig&&e.config.events.onPrepareConfig(e.config),e.prepare()}toggle(){const e=this;return e.isShown?e.hide():e.show()}show(){const e=this,t=e.config;e.isShown=!0,$(e.element).show(),t.events.onShown&&t.events.onShown()}hide(){const e=this,t=e.config;e.isShown=!1,$(e.element).hide(),t.events.onHidden&&t.events.onHidden()}async prepare(){const e=this,t=e.config,n=t.timeline;if(0==$("body").find(".zyk-timeliner").length){let n=document.createElement("div");$(n).addClass("zyk-timeliner theme-dark"),e.element=n,e.isShown=!0,t.events.onShown&&t.events.onShown(),$("body").append($(n))}else e.element=$("body").find(".zyk-timeliner")[0],$(e.element).empty();n.scale=n.scales[n.scaleIndex],n.pixelPerSecond=n.defaultPixelPerSecond*n.scale,await e.renderBasic(),e.renderTimeline(),e.renderScrollTimeline(),e.render()}async renderBasic(){const e=this;let t=await e.renderHeader(),n=await e.renderBody(),i=await e.renderFooter(),a=await e.renderPrepare(),l=document.createElement("div");$(l).addClass("zyk-timeliner-wrapper");let r=document.createElement("div");$(r).addClass("zyk-timeliner-inner"),$(r).append(t),$(r).append(n),$(r).append(i),$(r).append(a),$(l).append($(r)),$(e.element).append($(l))}renderHeader(){const e=this,t=e.config;let n=$('<div class="timeliner-header"></div>'),i=$('<div class="timeliner-header-left"></div>'),a=$('<div class="timeliner-header-right"></div>'),l=$(`\n            <div class="timeliner-control-preview">\n                <p>\n                    ${t.labels.controlPreview}\n                </p>\n\n                <div class="form-check">\n                    <input type="checkbox">\n                    <label data-toggle="check" data-type="switch">\n                        <div class="btn-switch btn-switch-primary">\n                            <div class="control"></div>\n                        </div>\n                    </label>\n                </div>\n            </div>\n        `);l.find('[data-toggle="check"]').unbind().on("check.zyk.check",function(){t.events.onCheckShowPreview&&t.events.onCheckShowPreview(!0,t.timeline.currentTime)}).on("uncheck.zyk.check",function(){t.events.onCheckShowPreview&&t.events.onCheckShowPreview(!1)}),i.append(l),n.append(i)
;let r=$(`\n            <button class="btn btn-sm btn-timeliner-action btn-collapse-timeliner" data-bs-toggle="tooltip" title="${t.labels.collapse}" type="button">\n                <i class="elo el-caret-down el-animation"></i>\n            </button>\n        `);r.unbind().on("click",function(){$(this).find("i").toggleClass("el-flip-y"),$(e.element).find(".zyk-timeliner-inner").toggleClass(t.classes.timelinerCollapsed),$(this).data("bsToggle")&&"tooltip"==$(this).data("bsToggle")&&$(this).tooltip("hide")});let o=$(`\n            <button class="btn btn-sm btn-timeliner-action btn-close-timeliner" data-bs-toggle="tooltip" title="${t.labels.close}" type="button">\n                <i class="elo el-close"></i>\n            </button>\n        `);o.unbind().on("click",function(){e.toggle(),$(this).data("bsToggle")&&"tooltip"==$(this).data("bsToggle")&&$(this).tooltip("hide")}),a.append(r),a.append(o),n.append(a);let s=$('\n            <div class="timeliner-video-preview">\n                <div class="timeliner-video-preview-header">\n                    <button class="btn btn-sm btn-close-video-preview" type="button">\n                        <i class="elo el-close"></i>\n                    </button>\n                </div>\n\n                <div class="timeliner-video-preview-body">\n                    <div class="preview-video"></div>\n                    <div class="preview-video-youtube">\n                        <div id="timelinerYoutube"></div>\n                    </div>\n                </div>\n            </div>\n        ');return s.find(".btn-close-video-preview").unbind().on("click",function(){s.find(".preview-video").empty(),s.find(".preview-video").hide(),s.find(".preview-video-youtube").hide(),s.hide()}),n.append(s),n.find('[data-bs-toggle="tooltip"]').tooltip(),n}renderBody(){const e=this,t=e.config;let n=$('<div class="timeliner-body"></div>'),i=$('<div class="timeliner-wrapper"></div>'),a=$('<div class="timeliner-wrapper-content"></div>'),l=$('<div class="timeliner-controls"></div>'),r=$(`\n            <button class="btn btn-sm btn-timeliner-action btn-play-timeliner" data-bs-toggle="tooltip" title="${t.labels.play}" type="button">\n                <i class="els el-play"></i>\n            </button>\n        `);r.unbind().on("click",function(){$(this).data("bsToggle")&&"tooltip"==$(this).data("bsToggle")&&$(this).tooltip("hide"),$(this).find("i").hasClass("el-play")?($(this).find("i").removeClass("els el-play").addClass("elo el-pause"),e.playTimeline(),t.events.onPlayTimeline&&t.events.onPlayTimeline()):($(this).find("i").removeClass("elo el-pause").addClass("els el-play"),e.pauseTimeline(),t.events.onPauseTimeline&&t.events.onPauseTimeline())}),l.append(r);let o=$(`\n            <button class="btn btn-sm btn-timeliner-action btn-stop-timeliner" data-bs-toggle="tooltip" title="${t.labels.stop}" type="button">\n                <i class="els el-square"></i>\n            </button>\n        `);o.unbind().on("click",function(){$(this).data("bsToggle")&&"tooltip"==$(this).data("bsToggle")&&$(this).tooltip("hide"),e.stopTimeline(),t.events.onStopTimeline&&t.events.onStopTimeline()}),l.append(o),l.append('<p class="p-overline timeliner-main-label">00:00:00</p>');let s=$(`\n            <button class="btn btn-sm btn-timeliner-action btn-add-layer-group" data-bs-toggle="tooltip" title="${t.labels.addLayer}" type="button">\n                <i class="elo el-plus"></i>\n            </button>\n        `);s.unbind().on("click",function(){$(this).data("bsToggle")&&"tooltip"==$(this).data("bsToggle")&&$(this).tooltip("hide"),t.events.onAddLayerGroup&&t.events.onAddLayerGroup()}),l.append(s),a.append(l);let d=$('<div class="timeliner-labels-wrapper"></div>'),c=$('<div class="timeliner-labels"></div>');d.append(c),a.append(d),i.append(a);let E=$('<div class="timeliner-wrapper-timeline"></div>'),p=$('<div class="timeliner-main-timeline-wrapper"></div>'),u=$('<div class="timeliner-main-timeline"></div>');p.append(u),E.append(p);let h=$('<div class="timeliner-timeline-layers"></div>');E.append(h);let m=$('<div class="timeliner-scroll-wrapper"></div>'),f=$('<div class="timeliner-scroll-inner"></div>');m.append(f),E.append(m),i.append(E);let g=$(`\n            <div class="timeliner-float-menu float-menu-video">\n                <ul class="list-group">\n                    <li class="list-group-item">\n                        <a href="#" class="timeliner-media-add-condition">\n                            ${lang["010116_37"]}\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        `);i.append(g);let T=$(`\n            <div class="timeliner-float-menu float-menu-video-condition">\n                <ul class="list-group">\n                    <li class="list-group-item">\n                        <a href="#" class="timeliner-media-remove-condition">\n                            ${lang["010116_112"]}\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        `);return i.append(T),n.append(i),n.find('[data-bs-toggle="tooltip"]').tooltip(),n}renderTimeline(){const e=this,t=e.config,n=t.timeline;let i=$(e.element).find(".timeliner-main-timeline");i.empty(),i.removeClass((e,t)=>(t.match(/(^|\s)timeline-\S+/g)||[]).join(" ")),i.addClass(n.classes[n.scaleIndex]),i.css({width:n.duration*n.pixelPerSecond,"background-size":n.pixelPerSecond});for(let e=0;e<n.duration;e++){let t=document.createElement("span");.2==n.scale&&e%5!=0?$(t).text(""):n.scale==1/30&&e%30!=0?$(t).text(""):$(t).text(zykUtil.secToMin(e)),$(t).css({width:n.pixelPerSecond}),i.append($(t))}e.initMainTimelineActions(i)}renderScrollTimeline(){const e=this,t=e.config,n=t.timeline;let i=$(e.element).find(".timeliner-wrapper-timeline"),a=$(e.element).find(".timeliner-main-timeline")[0],l=$(e.element).find(".timeliner-scroll-wrapper .timeliner-scroll-inner");l.empty();let r=document.createElement("div");$(r).addClass("scroll-control"),$(r).css({width:i.width()*l.width()/$(a).width(),left:n.offsetLeft}),l.append($(r)),$(r).unbind().draggable({containment:"parent",axis:"x",scroll:!1,start:(e,t)=>{},drag:(t,i)=>{n.offsetLeft=i.position.left,$(e.element).find(".timeliner-main-timeline-wrapper").scrollLeft(i.position.left*$(a).width()/l.width()),$(e.element).find(".timeliner-timeline-layers").scrollLeft(i.position.left*$(a).width()/l.width()),$(e.element).find(".timeliner-current-marker").css({left:n.currentTime*n.pixelPerSecond-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),$(e.element).find(".timeliner-current-liner").css({left:n.currentTime*n.pixelPerSecond-$(e.element).find(".timeliner-timeline-layers").scrollLeft()})},stop:(e,t)=>{}})}renderFooter(){const e=this,t=e.config,n=t.timeline;let i=$('<div class="timeliner-header"></div>'),a=$('<div class="timeliner-header-left"></div>'),l=$('<div class="timeliner-header-right"></div>'),r=$('<p class="p-sm timeline-layer-label"></p>'),o=$('<p class="p-sm timeline-layer-status"></p>');a.append(r),a.append(o),i.append(a);let s=$('<div class="timeliner-zoom-control"></div>'),d=$('\n            <button class="btn btn-timeliner-zoom" type="button">\n                <i class="elo el-minus"></i>\n            </button>\n        '),c=$('\n            <button class="btn btn-timeliner-zoom" type="button">\n                <i class="elo el-plus"></i>\n            </button>\n        ');return c.unbind().on("click",function(){0!=n.scaleIndex&&(n.scaleIndex--,n.scale=n.scales[n.scaleIndex],n.pixelPerSecond=n.defaultPixelPerSecond*n.scale,e.renderTimeline(),e.renderScrollTimeline(),e.render())}),d.unbind().on("click",function(){n.scaleIndex!=n.scales.length-1&&(n.scaleIndex++,n.scale=n.scales[n.scaleIndex],n.pixelPerSecond=n.defaultPixelPerSecond*n.scale,e.renderTimeline(),e.renderScrollTimeline(),e.render())}),s.append(d),s.append(c),l.append(s),i.append(l),i}renderPrepare(){const e=this;e.config;let t=$('<div class="timeliner-prepare"></div>'),n=$('\n            <div class="timeliner-label-group timeliner-label-group-prepare" style="display: none">\n                <div class="timeliner-label-group-header">\n                </div>\n                <div class="timeliner-label-group-body">\n                </div>\n            </div>\n        ');t.append(n);let i=$(`\n            <div class="timeliner-label-item timeliner-label-item-prepare" style="display: none">\n                <button class="btn btn-expand-timeliner-group" type="button">\n                    <i class="elo el-sm el-caret-right el-animation"></i>\n                </button>\n\n                <p class="group-label"></p>\n                <h6 class="subtitle-sm group-label"></h6>\n\n                <div class="btn-group">\n                    <button class="btn btn-sm btn-timeliner-action btn-add-action" type="button">\n                        <i class="elo el-plus"></i>\n                    </button>\n                    <button class="btn btn-sm btn-timeliner-action btn-play-audio" data-bs-toggle="dropdown" type="button">\n                        <i class="els el-play"></i>\n                    </button>\n                    <ul class="dropdown-menu dropdown-menu-play"></ul>\n                    <button class="btn btn-sm btn-timeliner-action btn-edit" data-bs-toggle="dropdown" type="button">\n                        <i class="elo el-pencil"></i>\n                    </button>\n                    <ul class="dropdown-menu dropdown-menu-edit"></ul>\n                    <button class="btn btn-sm btn-timeliner-action btn-remove" data-bs-toggle="dropdown" type="button">\n                        <i class="elo el-trash"></i>\n                    </button>\n                    <ul class="dropdown-menu dropdown-menu-remove"></ul>\n                    <button class="btn btn-sm btn-timeliner-action btn-more" data-bs-toggle="dropdown" type="button">\n                        <i class="elo el-ellipsis-v"></i>\n                    </button>\n                    <ul class="dropdown-menu dropdown-menu-more">\n                        <li>\n                            <a href="#" class="dropdown-item btn-ungroup">\n                                ${lang["010116_5"]}\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        `);t.append(i);let a=$('\n            <div class="timeliner-layer-group timeliner-layer-group-prepare" style="display: none">\n                <div class="timeliner-layer-group-header">\n                </div>\n                <div class="timeliner-layer-group-body">\n                </div>\n            </div>\n        ');t.append(a);let l=$('<div class="timeliner-layer-group-item timeliner-layer-group-item-prepare" style="display: none"></div>');t.append(l);let r=$('\n            <div class="timeline-layer-frame timeline-layer-frame-prepare" style="display: none">\n                <div class="timeline-layer-frame-inner"></div>\n            </div>\n        ');t.append(r);let o=document.createElement("audio");return o.controls=!1,o.autoplay=!1,o.onpause=(()=>{$(e.element).find(".timeliner-label-item").each(function(){$(this).find(".btn-play-audio i").removeClass("elo el-pause").addClass("els el-play")})}),o.onended=(()=>{$(e.element).find(".timeliner-label-item").each(function(){$(this).data("id")==e.layerPlayingAudio&&$(this).find(".btn-play-audio i").removeClass("elo el-pause").addClass("els el-play")})}),e.audio=o,t.append($(o)),t}async render(){const e=this,t=e.config;t.events.onBeforeRender&&await t.events.onBeforeRender();let n=await e.getLongestTimer();if(n>t.timeline.duration)return t.timeline.duration=n,e.prepare();await e.updateChildren(),await e.renderLabels(),await e.renderLayers(),t.events.onRendered&&await t.events.onRendered(),$(e.element).find(".zyk-timeliner-inner").unbind().on("click",function(t){0==$(t.target).parents(".timeliner-float-menu").length&&e.removeFloatMenu(),$(e.element).find(".timeline-layers-action").length>0&&$(e.element).find(".timeline-layers-action").remove()}).on("click",".timeliner-media-add-condition",async function(n){n.preventDefault(),n.stopPropagation();let i=$(this).parents(".timeliner-float-menu"),a=i.data("action-id");if(e.removeFloatMenu(),t.events.onAddMediaCondition&&a){let n=await e.getLayerByActionId(a);if(n){let e=Number((t.timeline.currentTime-n.start).toFixed(1));e<0&&(e=0),t.events.onAddMediaCondition(a,e)}}}).on("click",".timeliner-media-remove-condition",function(n){n.preventDefault(),n.stopPropagation();let i=$(this).parents(".timeliner-float-menu"),a=i.data("condition-id"),l=i.data("action-id");e.removeFloatMenu(),t.events.onRemoveMediaCondition&&a&&t.events.onRemoveMediaCondition(a,l)})}updateChildren(){const e=this,t=e.config;if(Object.keys(t.layers.data).length>0)for(let e in t.layers.data){let n=t.layers.data[e];if(n.children.length>0)for(let t=0;t<n.children.length;t++){let i=n.children[t];i.parentId||(i.parentId=e)}}}renderLabels(){const e=this,t=e.config;if($(e.element).find(".timeliner-labels").empty(),Object.keys(t.layers.data).length>0){let n=[];for(let e=0;e<Object.keys(t.layers.data).length;e++){let i=Object.keys(t.layers.data)[e],a=t.layers.data[i];n.push(a)}n=n.sort((e,t)=>t.index-e.index);for(let t=0;t<n.length;t++){let i=n[t],a=e.getLabelGroup(i);$(e.element).find(".timeliner-labels").append(a),$(e.element).find(".timeliner-labels .timeliner-label-group").each(function(){let t=$(this).data("id");e.openedGroup.indexOf(t)>-1&&($(this).find(".timeliner-label-group-body").addClass("shown"),$(this).find(".btn-expand-timeliner-group i").addClass("el-rotate-90"))})}e.initTimelineLabelsActions()}}renderLayers(){const e=this,t=e.config;if($(e.element).find(".timeliner-timeline-layers").empty(),Object.keys(t.layers.data).length>0){let n=[];for(let e=0;e<Object.keys(t.layers.data).length;e++){let i=Object.keys(t.layers.data)[e],a=t.layers.data[i];n.push(a)}n=n.sort((e,t)=>e.index-t.index);for(let t=0;t<n.length;t++){let i=n[t],a=e.getLayerGroup(i);$(e.element).find(".timeliner-timeline-layers").append(a)}$(e.element).find(".timeliner-timeline-layers .timeliner-layer-group").each(function(){let t=$(this).data("linked-id");e.openedGroup.indexOf(t)>-1&&$(this).find(".timeliner-layer-group-body").addClass("shown")})}}getLabelGroup(e){const t=this,n=t.config,i=n.timeline;let a=$(t.element).find(".timeliner-label-group-prepare").clone().show();a.removeClass("timeliner-label-group-prepare");let l=$(t.element).find(".timeliner-label-item-prepare").clone().show();if(l.removeClass("timeliner-label-item-prepare"),a.data("id",e.id),l.find(".btn-play-audio").remove(),l.find(".dropdown-menu-play").remove(),l.find(".btn-more").remove(),l.find(".dropdown-menu-more").remove(),l.find("p.group-label").remove(),l.find("h6.group-label").text(e.label),e.children.length>0){a.find(".timeliner-label-group-body").empty(),e.children=e.children.sort((e,t)=>t.index-e.index);for(let i=0;i<e.children.length;i++){let l=e.children[i],r=t.getLabelGroupItem(l);a.find(".timeliner-label-group-body").append(r),a.find(".timeliner-label-group-body").sortable({items:".timeliner-label-item",placeholder:"timeliner-label-item-placeholder",stop:()=>{for(let t=0;t<a.find(".timeliner-label-group-body .timeliner-label-item").length;t++){let n=$(a.find(".timeliner-label-group-body .timeliner-label-item")[t]),i=n.data("id"),l=e.children.find(e=>e.id==i);l&&(l.index=-1*(t-a.find(".timeliner-label-group-body .timeliner-label-item").length))}t.render(),n.events.onStopSortLayerItem&&n.events.onStopSortLayerItem()}})}}return a.find(".timeliner-label-group-header").append(l),a.unbind().on("click",function(){t.activeGroup=e.id,t.activeLayer=[],t.updateActiveLayer()}).on("click",".btn-expand-timeliner-group",function(n){n.stopPropagation();let i=$(this).parents(".timeliner-label-group").data("id");-1==t.openedGroup.indexOf(i)?t.openedGroup.push(i):t.openedGroup=t.openedGroup.filter(e=>e!=i),$(this).find("i").toggleClass("el-rotate-90"),a.find(".timeliner-label-group-body").toggleClass("shown"),$(t.element).find(".timeliner-timeline-layers").find(`.timeliner-layer-group[data-linked-id=${e.id}] .timeliner-layer-group-body`).toggleClass("shown"),t.updateTimelineLinerHeight()}).on("click",".btn-add-action",function(a){a.stopPropagation(),t.activeGroup=e.id,t.activeLayer=[],n.events.onAddLayer&&n.events.onAddLayer(e.id,i.currentTime)}).on("click",".btn-edit",function(t){t.stopPropagation(),n.events.onEditLayerGroup&&n.events.onEditLayerGroup(e.id)}).on("click",".btn-remove",function(i){i.stopPropagation(),showModalConfirm(lang["000200_93"],()=>{let i=[];if(n.layers.data[e.id]&&n.layers.data[e.id].children.length>0)for(let t=0;t<n.layers.data[e.id].children.length;t++){let a=n.layers.data[e.id].children[t];if(a.timer&&a.timer.length>0)for(let e=0;e<a.timer.length;e++)i.push(a.timer[e].actionId)}let a=JSON.stringify(i);if(delete n.layers.data[e.id],$(this).parents(".timeliner-label-group").remove(),$(t.element).find(`.timeliner-timeline-layers .timeliner-layer-group[data-linked-id=${e.id}]`).remove(),n.events.onRemoveLayerGroup&&n.events.onRemoveLayerGroup(a),0==Object.keys(n.layers.data).length){let e=eldraw.util.randomId();n.layers.data[e]={index:1,id:e,label:lang["010205_76"],children:[]},t.updateLayers(n.layers)}})}),a}getLabelGroupItem(e){const t=this,n=t.config,i=n.timeline;let a=$(t.element).find(".timeliner-label-item-prepare").clone().show();a.removeClass("timeliner-label-item-prepare"),a.data("id",e.id),a.find("h6.group-label").remove();let l="";if(e.timer&&e.timer.length>0)for(let t=0;t<e.timer.length;t++)l+=e.timer[t].label,t<e.timer.length-1&&(l+=" | ");if(a.find("p.group-label").text(l),a.find(".btn-expand-timeliner-group").remove(),a.find(".btn-add-action").remove(),e.timer&&e.timer.length>0){1==e.timer.length&&(a.find(".btn-more").remove(),a.find(".dropdown-menu-more").remove());for(let l=0;l<e.timer.length;l++){let r=e.timer[l];"audio"!=r.actionType&&"video"!=r.actionType&&(a.find(".btn-play-audio").remove(),a.find(".dropdown-menu-play").remove());let o=$("<li></li>"),s=$(`\n                    <a href="#" class="dropdown-item">\n                        ${r.label}\n                    </a>\n                `);s.unbind().on("click",function(e){e.stopPropagation(),e.preventDefault(),n.events.onEditLayer&&n.events.onEditLayer(r.actionId)}),s.appendTo(o),a.find(".dropdown-menu-edit").append(o);let d=$("<li></li>"),c=$(`\n                    <a href="#" class="dropdown-item">\n                        ${r.label}\n                    </a>\n                `);c.unbind().on("click",function(i){i.stopPropagation(),i.preventDefault(),showModalConfirm(lang["000200_93"],()=>{if(e.timer&&e.timer.length>0){let t=e.timer.findIndex(e=>e.actionId=r.actionId);if(t>-1&&e.timer.splice(t,1),0==e.timer.length){let t=n.layers.data[e.parentId];if(t&&t.children&&t.children.length>0){let n=t.children.findIndex(t=>t.id==e.id);n>-1&&t.children.splice(n,1)}}}$(this).parents(".timeliner-label-item").remove(),$(t.element).find(".timeline-layer-frame").each(function(){$(this).data("action-id")==r.actionId&&$(this).parent().remove()}),0==n.layers.data[e.parentId].children.length&&$(t.element).find(`.timeliner-layer-group[data-linked-id="${e.parentId}"]`).find(".timeliner-layer-group-header .timeliner-layer-group-item").empty(),n.events.onRemoveLayer&&n.events.onRemoveLayer(r.actionId)})}),c.appendTo(d),a.find(".dropdown-menu-remove").append(d);let E=$("<li></li>"),p=$(`\n                    <a href="#" class="dropdown-item">\n                        ${r.label}\n                    </a>\n                `);p.unbind().on("click",function(a){a.preventDefault(),$(this).parents(".dropdown-menu").prev().find("i").hasClass("el-play")?"audio"==r.actionType?(t.audio.src&&t.pauseAudio(),$(t.element).find(".timeliner-label-item").each(function(){$(this).find(".btn-play-audio i").removeClass("elo el-pause").addClass("els el-play")}),$(this).parents(".dropdown-menu").prev().find("i").removeClass("els el-play").addClass("elo el-pause"),t.layerPlayingAudio=e.id,(i.currentTime<r.start||i.currentTime>=r.end)&&(t.moveTimelinerLinerToTime(r.start),i.currentTime=r.start),n.events.onRequestPlayAudioUrl&&n.events.onRequestPlayAudioUrl(r.actionId)):"video"==r.actionType&&(t.video&&t.pauseVideo(),$(t.element).find(".timeliner-label-item").each(function(){$(this).find(".btn-play-audio i").removeClass("elo el-pause").addClass("els el-play")}),$(this).parents(".dropdown-menu").prev().find("i").removeClass("els el-play").addClass("elo el-pause"),t.layerPlayingVideo=e.id,(i.currentTime<r.start||i.currentTime>=r.end)&&(t.moveTimelinerLinerToTime(r.start),i.currentTime=r.start),n.events.onRequestPlayVideoUrl&&n.events.onRequestPlayVideoUrl(r.actionId)):($(this).parents(".dropdown-menu").prev().find("i").removeClass("elo el-pause").addClass("els el-play"),"audio"==r.actionType?t.pauseAudio():"video"==r.actionType&&t.pauseVideo())}),p.appendTo(E),a.find(".dropdown-menu-play").append(E)}}return a.unbind().on("click",function(n){n.stopPropagation(),$(t.element).find(".timeline-layers-action").length>0&&$(t.element).find(".timeline-layers-action").remove(),t.activeGroup=null,zykKeys.shiftDown?-1==t.activeLayer.indexOf(e.id)?t.activeLayer.push(e.id):t.activeLayer=t.activeLayer.filter(t=>t!=e.id):t.activeLayer=[e.id],t.updateActiveLayer()}).on("contextmenu",function(e){let n;if(e.preventDefault(),e.stopPropagation(),n=$(e.target).hasClass("timeliner-label-item")?$(this):$(e.target).parents(".timeliner-label-item"),$(t.element).find(".timeline-layers-action").length>0&&$(t.element).find(".timeline-layers-action").remove(),t.activeLayer.length>1){let e=document.createElement("div");$(e).addClass("timeline-layers-action");let i=$(`<a href="#">${lang["010116_7"]}</a>`);i.unbind().on("click",function(n){n.preventDefault(),$(e).remove(),t.groupLayers()}),$(e).append(i),$(t.element).find(".zyk-timeliner-wrapper").append($(e)),Popper.createPopper(n[0],e,{placement:"top-end",modifiers:[{name:"flip",enabled:!0,options:{}}]})}}).on("click",".btn-ungroup",function(i){i.stopPropagation();let a=n.layers.data[e.parentId];if(a){let n=a.children.find(t=>t.id==e.id);if(n){let i=n.timer;for(let n=0;n<i.length;n++){let a=i[n],l={id:eldraw.util.randomId(),timer:[{actionId:a.actionId,label:a.label,actionType:a.actionType,objectId:a.objectId,start:a.start,end:a.end}]};t.addLayer(l,e.parentId)}t.removeLayer(e.id),t.render()}}}),a}getLayerGroup(e){const t=this,n=t.config,i=n.timeline;let a=$(t.element).find(".timeliner-layer-group-prepare").clone().show();a.removeClass("timeliner-layer-group-prepare"),a.css({width:i.duration*i.pixelPerSecond});let l=$(t.element).find(".timeliner-layer-group-item-prepare").clone().show();if(l.removeClass("timeliner-layer-group-item-prepare"),a.find(".timeliner-layer-group-header").append(l),a.attr("data-linked-id",e.id),e.children.length>0){a.find(".timeliner-layer-group-body").empty();let l=t.getGroupTimer(e.id);if(l){let r=l.end-l.start;r<0&&(r=0);let o,s=$(t.element).find(".timeline-layer-frame-prepare").clone().show();s.removeClass("timeline-layer-frame-prepare"),s.data("id",e.id),s.css({width:r*i.pixelPerSecond,left:l.start*i.pixelPerSecond}),s.unbind().on("dblclick",function(){}).draggable({containment:"parent",grid:[i.pixelPerSecond/(i.step/i.scale),0],axis:"x",start:(e,t)=>{o=Number((Math.ceil(t.position.left)/i.pixelPerSecond).toFixed(1))},drag:(e,a)=>{let l=Number((Math.ceil(a.position.left)/i.pixelPerSecond).toFixed(1)),r=Number(($(a.helper[0]).width()/i.pixelPerSecond).toFixed(1)),o=Number((l+r).toFixed(1));$(t.element).find(".timeline-layer-status").text(`${n.labels.start}: ${l} | ${n.labels.duration}: ${r} | ${n.labels.end}: ${o}`)},stop:(e,a)=>{let r=Number((Math.ceil(a.position.left)/i.pixelPerSecond).toFixed(1)),s=Number(($(a.helper[0]).width()/i.pixelPerSecond).toFixed(1)),d=Number((r+s).toFixed(1)),c=$(a.helper[0]).data("id"),E=n.layers.data[c];$(t.element).find(".timeline-layer-status").text(""),l=[r,d];let p=Number((r-o).toFixed(1));if(n.layers.data[c]&&n.layers.data[c].children.length>0)for(let e=0;e<n.layers.data[c].children.length;e++){let t=n.layers.data[c].children[e];if(t.timer&&t.timer.length>0)for(let e=0;e<t.timer.length;e++){let i=t.timer[e];i.start=Number((i.start+p).toFixed(1)),i.end=Number((i.end+p).toFixed(1)),i.duration=Number((i.end-i.start).toFixed(1));let a={actionId:i.actionId,start:i.start,duration:i.duration,end:i.end};n.events.onUpdateFrame&&n.events.onUpdateFrame(a)}}$(a.helper[0]).parents(".timeliner-layer-group").find(".timeliner-layer-group-body .timeliner-layer-group-item").each(function(){let e=$(this).find(".timeline-layer-frame"),t=e.position().left;e.css({left:t+p*i.pixelPerSecond})}),n.events.onUpdateGroupFrame&&n.events.onUpdateGroupFrame(E)}}),a.find(".timeliner-layer-group-header .timeliner-layer-group-item").append(s)}e.children=e.children.sort((e,t)=>t.index-e.index);for(let n=0;n<e.children.length;n++){let i=e.children[n],l=t.getLayerGroupItem(i);a.find(".timeliner-layer-group-body").append(l)}}return a}getLayerGroupItem(e){const t=this,n=t.config,i=n.timeline;let a=$(t.element).find(".timeliner-layer-group-item-prepare").clone().show();if(a.removeClass("timeliner-layer-group-item-prepare"),e.timer&&e.timer.length>0)for(let l=0;l<e.timer.length;l++){let r=e.timer[l],o=Number((r.end-r.start).toFixed(1));o<0&&(o=0);let s=$(t.element).find(".timeline-layer-frame-prepare").clone().show();if(s.removeClass("timeline-layer-frame-prepare"),s.data("action-id",r.actionId),s.data("id",e.id),"object"==r.actionType?s.addClass("frame-object"):"audio"==r.actionType?s.addClass("frame-audio"):"video"==r.actionType?s.addClass("frame-video"):"slide"==r.actionType?s.addClass("frame-slide"):"object-non-duration"==r.actionType?s.addClass("frame-object-non-duration"):"audio-non-duration"==r.actionType?s.addClass("frame-audio-non-duration"):"video-non-duration"==r.actionType?s.addClass("frame-video-non-duration"):"slide-non-duration"==r.actionType&&s.addClass("frame-slide-non-duration"),s.css({width:o*i.pixelPerSecond,left:r.start*i.pixelPerSecond}),("video"==r.actionType||"audio"==r.actionType)&&r.conditions&&r.conditions.length>0)for(let e=0;e<r.conditions.length;e++){let i=r.conditions[e],a=$('<div class="timeline-media-condition-marker"></div>');a.data("condition-id",i.conditionId);let l=i.time/(r.end-r.start)*100;a.css({left:`${l}%`});let o=lang["010216_217"];"video"==r.actionType?o=o.replaceAll("!!MEDIA!!",`${action_sheet.getVideoNameByMediaId(r.objectId)}`):"audio"==r.actionType&&(o=o.replaceAll("!!MEDIA!!",`${action_sheet.getAudioNameByMediaId(r.objectId)}`)),o=o.replaceAll("!!TIME!!",i.time),o+="s",a.unbind().tooltip({title:o,trigger:"manual"}).on("mouseenter",function(){$(this).tooltip("show")}).on("mouseleave",function(){$(this).tooltip("hide")}).on("click",function(e){e.stopPropagation(),$(this).tooltip("hide"),n.events.onSelectMediaCondition&&n.events.onSelectMediaCondition(i.conditionId)}).on("contextmenu",function(e){let n;e.preventDefault(),e.stopPropagation(),t.removeFloatMenu(),"video"==r.actionType&&(n=$(t.element).find(".float-menu-video-condition"),n.css({top:e.clientY-$(t.element).find(".timeliner-wrapper").offset().top,left:e.clientX}),n.data("condition-id",i.conditionId),n.data("action-id",r.actionId),n.show())}),s.find(".timeline-layer-frame-inner").append(a)}s.unbind().on("contextmenu",function(e){let n;e.preventDefault(),e.stopPropagation(),t.removeFloatMenu(),"video"!=r.actionType&&"audio"!=r.actionType||(n=$(t.element).find(".float-menu-video"),n.css({top:e.clientY-$(t.element).find(".timeliner-wrapper").offset().top,left:e.clientX}),n.data("action-id",r.actionId),n.show())}).on("click",function(e){e.stopPropagation(),t.activeGroup=null,t.activeLayer=[r.id],t.updateActiveLayer()}).on("dblclick",function(e){e.stopPropagation();let t=$(this).data("action-id");n.events.onDblClickFrame&&n.events.onDblClickFrame(t)}).resizable({containment:"parent",grid:i.pixelPerSecond/i.step,handles:"e,w",start:(e,t)=>{},resize:(e,a)=>{($(a.helper[0]).hasClass("frame-audio")||$(a.helper[0]).hasClass("frame-video")||$(a.helper[0]).hasClass("frame-object-non-duration")||$(a.helper[0]).hasClass("frame-audio-non-duration")||$(a.helper[0]).hasClass("frame-video-non-duration")||$(a.helper[0]).hasClass("frame-slide-non-duration"))&&(a.size.width=a.originalSize.width),a.size.height=a.originalSize.height;let l=Number((Math.ceil(a.position.left)/i.pixelPerSecond).toFixed(1)),r=Number(($(a.helper[0]).width()/i.pixelPerSecond).toFixed(1)),o=Number((l+r).toFixed(1));$(t.element).find(".timeline-layer-status").text(`${n.labels.start}: ${l} | ${n.labels.duration}: ${r} | ${n.labels.end}: ${o}`)},stop:(e,a)=>{let l=Number((Math.ceil(a.position.left)/i.pixelPerSecond).toFixed(1)),r=Number(($(a.helper[0]).width()/i.pixelPerSecond).toFixed(1)),o=Number((l+r).toFixed(1)),s=$(a.helper[0]).closest(".timeliner-layer-group").data("linked-id"),d=$(a.helper[0]).data("action-id"),c=$(a.helper[0]).data("id");if($(t.element).find(".timeline-layer-status").text(""),n.layers.data[s]&&n.layers.data[s].children.length>0){let e=n.layers.data[s].children.find(e=>e.id==c);if(e&&e.timer&&e.timer.length>0){let t=e.timer.find(e=>e.actionId==d);t&&(t.start=l,t.end=o)}}let E={actionId:d,start:l,duration:r,end:o};n.events.onUpdateFrame&&n.events.onUpdateFrame(E)}}).draggable({containment:"parent",grid:[i.pixelPerSecond/(i.step/i.scale),0],axis:"x",start:(e,t)=>{$("body").find(".tooltip").length>0&&$("body").find(".tooltip").remove()},drag:(e,a)=>{let l=Number((Math.ceil(a.position.left)/i.pixelPerSecond).toFixed(1)),r=Number(($(a.helper[0]).width()/i.pixelPerSecond).toFixed(1)),o=Number((l+r).toFixed(1));$(t.element).find(".timeline-layer-status").text(`${n.labels.start}: ${l} | ${n.labels.duration}: ${r} | ${n.labels.end}: ${o}`)},stop:(e,a)=>{let l=Number((Math.ceil(a.position.left)/i.pixelPerSecond).toFixed(1)),r=Number(($(a.helper[0]).width()/i.pixelPerSecond).toFixed(1)),o=Number((l+r).toFixed(1)),s=$(a.helper[0]).closest(".timeliner-layer-group").data("linked-id"),d=$(a.helper[0]).data("action-id"),c=$(a.helper[0]).data("id");if($(t.element).find(".timeline-layer-status").text(""),n.layers.data[s]&&n.layers.data[s].children.length>0){let e=n.layers.data[s].children.find(e=>e.id==c);if(e&&e.timer&&e.timer.length>0){let t=e.timer.find(e=>e.actionId==d);t&&(t.start=l,t.end=o)}}let E={actionId:d,start:l,duration:r,end:o};n.events.onUpdateFrame&&n.events.onUpdateFrame(E)}}),a.append(s)}return a}createTimelineMarker(e,t=!1){const n=this,i=n.config,a=i.timeline;t||(t=a.currentTime);let l=document.createElement("div");return $(l).addClass("timeliner-current-marker"),e.parent().append($(l)),$(l).css({left:t*a.pixelPerSecond}),$(l)}createTimelineLiner(e,t=!1){const n=this,i=n.config,a=i.timeline;t||(t=a.currentTime),e.parent().find(".timeliner-current-liner").length>0&&e.parent().find(".timeliner-current-liner").remove();let l=document.createElement("div");return $(l).addClass("timeliner-current-liner"),e.parent().append($(l)),$(l).css({left:t*a.pixelPerSecond}),n.updateTimelineLinerHeight(),$(l)}moveTimelinerLinerToTime(e){console.log(e);const t=this,n=t.config,i=n.timeline,a=$(t.element).find(".timeliner-current-liner"),l=$(t.element).find(".timeliner-current-marker");$(t.element).find(".timeliner-timeline-layers").scrollLeft(e*i.pixelPerSecond),a.css({left:0}),l.css({left:0})}initMainTimelineActions(){const e=this,t=e.config,n=t.timeline;let i=$(e.element).find(".timeliner-main-timeline"),a=e.createTimelineMarker(i,n.currentTime),l=e.createTimelineLiner(i,n.currentTime);i.unbind().on("click",function(t){let r=t.pageX-i.offset().left,o=Number((Math.ceil(r)/n.pixelPerSecond).toFixed(1));a.css({left:o*n.pixelPerSecond-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),l.css({left:o*n.pixelPerSecond-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),n.currentTime=o,a.draggable({containment:"parent",axis:"x",start:()=>{},drag:(e,t)=>{l.css({left:t.position.left})},
stop:(t,i)=>{let r=Number((Math.ceil(i.position.left+$(e.element).find(".timeliner-timeline-layers").scrollLeft())/n.pixelPerSecond).toFixed(1));a.css({left:r*n.pixelPerSecond-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),l.css({left:r*n.pixelPerSecond-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),n.currentTime=r}})})}initTimelineLabelsActions(){const e=this,t=e.config;let n=$(e.element).find(".timeliner-labels-wrapper"),i=$(e.element).find(".timeliner-labels"),a=$(e.element).find(".timeliner-timeline-layers");n.on("scroll",function(e){let t=$(this).scrollTop();a.scrollTop(t)}),a.on("scroll",function(e){let t=$(this).scrollTop();i.scrollTop(t)}),i.sortable({items:".timeliner-label-group",placeholder:"timeliner-label-group-placeholder",stop:()=>{i.find(".timeliner-label-group").each(function(e){let n=$(this).data("id");t.layers.data[n]&&(t.layers.data[n].index=e+1)}),e.renderLayers(),t.events.onStopSortLayerGroup&&t.events.onStopSortLayerGroup()}})}updateTimelineLinerHeight(){const e=this;let t=$(e.element).find(".timeliner-current-liner");t.css({height:$(e.element).find(".timeliner-wrapper-timeline")[0].scrollHeight-12})}updateActiveLayer(){const e=this;e.config;$(e.element).find(".timeliner-labels .timeliner-label-group").removeClass("active"),$(e.element).find(".timeliner-labels .timeliner-label-item").removeClass("active"),$(e.element).find(".timeliner-timeline-layers .timeliner-layer-group").removeClass("active"),$(e.element).find(".timeliner-timeline-layers .timeliner-layer-group .timeliner-layer-group-item").removeClass("active"),e.activeGroup&&($(e.element).find(".timeliner-labels .timeliner-label-group").each(function(){$(this).data("id")==e.activeGroup&&$(this).addClass("active")}),$(e.element).find(".timeliner-timeline-layers .timeliner-layer-group").each(function(){$(this).data("linked-id")==e.activeGroup&&$(this).addClass("active")})),e.activeLayer.length>0&&($(e.element).find(".timeliner-labels .timeliner-label-group-body .timeliner-label-item").each(function(){e.activeLayer.indexOf($(this).data("id"))>-1&&$(this).addClass("active")}),$(e.element).find(".timeliner-timeline-layers .timeliner-layer-group .timeliner-layer-group-item").each(function(){e.activeLayer.indexOf($(this).find(".timeline-layer-frame").data("id"))>-1&&$(this).addClass("active")}))}async groupLayers(){const e=this,t=e.config;let n,i,a=[],l=0,r=[];for(let i=0;i<e.activeLayer.length;i++){let l=e.activeLayer[i],o=await e.getLayerById(l);if(o)if(n){if(n!=o.parentId){if(a=[],r=[],t.events.onSendMessage){let e={type:"warning",content:"Layers are not in the same group"};t.events.onSendMessage(e)}break}n=o.parentId,a.push(o),r.push(o.index)}else n=o.parentId,a.push(o),r.push(o.index)}l=Math.min(...r);let o,s=[];if(a.length>0){for(let e=0;e<a.length;e++){let n=a[e];if(n.index==l&&(i=n),o)if(o!=n.timer[0].actionType){if(t.events.onSendMessage){let e={type:"warning",content:"Layers are not the same type"};t.events.onSendMessage(e)}}else o=n.timer[0].actionType,s=s.concat(n.timer);else n.timer.length>0&&(o=n.timer[0].actionType,s=s.concat(n.timer))}if(s.length>0){s=s.sort((e,t)=>e.start-t.start);for(let e=0;e<s.length;e++){let n=s[e];if(s[e-1]){let i=Number((n.end-n.start).toFixed(1));if(n.start<s[e-1].end){n.start=s[e-1].end,n.end=Number((n.start+i).toFixed(1));let a={actionId:n.actionId,start:n.start,end:n.end,duration:i};t.events.onUpdateFrame&&t.events.onUpdateFrame(a)}}}}i&&(i.timer=s);for(let t=0;t<a.length;t++){let n=a[t];n.id!=i.id&&await e.removeLayer(n.id)}e.render()}}getLayerById(e){const t=this,n=t.config;return new Promise(t=>{let i=!1;for(let t in n.layers.data){let a=n.layers.data[t];if(a.children.length>0){let t=a.children.find(t=>t.id==e);t&&(i=t)}}t(i)})}getLayerByActionId(e){const t=this,n=t.config;return new Promise(t=>{if(Object.keys(n.layers.data).length>0)for(let i in n.layers.data){let a=n.layers.data[i];if(a.children.length>0)for(let n=0;n<a.children.length;n++){let i=a.children[n].timer;if(i&&i.length>0){let n=i.find(t=>t.actionId==e);n&&t(n)}else t(!1)}else t(!1)}})}getGroupTimer(e){const t=this,n=t.config;let i=n.layers.data[e],a={};if(i){let e=i.children,t=[],n=[];for(let i=0;i<e.length;i++){let a=e[i];if(a.timer&&a.timer.length>0)for(let e=0;e<a.timer.length;e++)t.push(a.timer[e].start),n.push(a.timer[e].end)}a.start=Math.min(...t),a.end=Math.max(...n)}return a}getLayerGroupHighestIndex(){const e=this,t=e.config;return new Promise(e=>{let n=0,i=[];if(Object.keys(t.layers.data).length>0){for(let e in t.layers.data)i.push(t.layers.data[e].index);n=Math.max(...i)}e(n+1)})}getLayerHighestIndex(e){const t=this,n=t.config;return new Promise(t=>{let i=[],a=n.layers.data[e],l=0;if(a.children.length>0){for(let e=0;e<a.children.length;e++){let t=a.children[e];i.push(t.index)}l=Math.max(...i)}t(l)})}getLongestTimer(){const e=this,t=e.config,n=t.timeline;let i=n.duration,a=[];return new Promise(e=>{if(Object.keys(t.layers.data).length>0)for(let e in t.layers.data){let n=t.layers.data[e];if(n.children.length>0)for(let e=0;e<n.children.length;e++){let t=n.children[e];if(t.timer&&t.timer.length>0)for(let e=0;e<t.timer.length;e++){let n=t.timer[e];n.end&&a.push(n.end)}}}if(a.length>0){let e=Math.max(...a);e>i&&(i=e)}e(i)})}playTimeline(e=!1){function t(e,i,r,s){e=e||(new Date).getTime();let d=e-l,c=d/s;c=Math.min(c,1);let E=o+r*c;if(i.parent().find(".timeliner-current-marker").css({left:E}),i.parent().find(".timeliner-current-liner").css({left:E}),a.currentTime=E/a.pixelPerSecond,E>i.parent().width()){let e=E-i.parent().width();i.parent().find(".timeliner-current-marker").css({left:E-(e+100)}),i.parent().find(".timeliner-current-liner").css({left:E-(e+100)}),$(n.element).find(".timeliner-main-timeline-wrapper").scrollLeft(e+100),$(n.element).find(".timeliner-timeline-layers").scrollLeft(e+100)}$(n.element).find(".timeliner-main-label").text(zykUtil.secToMin(a.currentTime)),d<s&&(n.requestAnimation=requestAnimationFrame(e=>{t(e,i,r,s)}))}const n=this,i=n.config,a=i.timeline;let l,r,o,s=$(n.element).find(".timeliner-main-timeline");e?e*=1e3:e=1e3*(a.duration-a.currentTime),r=e/1e3*a.pixelPerSecond,o=a.currentTime*a.pixelPerSecond,n.requestAnimation=requestAnimationFrame(n=>{l=n||(new Date).getTime(),t(n,s,r,e)})}pauseTimeline(){const e=this;cancelAnimationFrame(e.requestAnimation)}stopTimeline(){const e=this,t=e.config,n=t.timeline;n.currentTime=0;let i=$(e.element).find(".timeliner-current-marker"),a=$(e.element).find(".timeliner-current-liner");i.css({left:0-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),a.css({left:0-$(e.element).find(".timeliner-timeline-layers").scrollLeft()}),$(e.element).find(".btn-play-timeliner").find("i").removeClass("elo el-pause").addClass("els el-play"),$(e.element).find(".timeliner-main-label").text(zykUtil.secToMin(0)),cancelAnimationFrame(e.requestAnimation)}async playAudio(e,t,n){const i=this,a=i.config,l=a.timeline;let r=await i.getLayerByActionId(t);if(r){let t=Number((r.end-r.start).toFixed(1));t!=n&&(t=n,r.end=Number((r.start+n).toFixed(1)),await i.render()),l.currentTime>r.start&&(t=Number((r.end-l.currentTime).toFixed(1))),i.playTimeline(t);let a=0;l.currentTime>r.start&&(a=Number((l.currentTime-r.start).toFixed(1))),i.audio.src=e,i.audio.currentTime=a,i.audio.play()}}pauseAudio(){const e=this;e.pauseTimeline(),e.audio.pause()}async playVideo(e,t){const n=this,i=n.config,a=i.timeline;let l=await n.getLayerByActionId(t);if(l){let t=Number((l.end-l.start).toFixed(1));t!=e.duration&&(t=e.duration,l.end=Number((l.start+e.duration).toFixed(1)),await n.render()),a.currentTime>l.start&&(t=Number((l.end-a.currentTime).toFixed(1)));let i=0;a.currentTime>l.start&&(i=Number((a.currentTime-l.start).toFixed(1)));let o=$(n.element).find(".timeliner-video-preview").show();if(o.find(".preview-video").empty(),n.videoType!=e.type&&(n.video=null),e.type==zykVar.fileTypes.VIDEO){if(!Hls)throw new Error("Hls is not defined");if(o.find(".preview-video").show(),o.find(".preview-video-youtube").hide(),Hls.isSupported()){var r=new Hls;let a=document.createElement("video");a.autoplay=!0,a.controls=!1,a.style.width="100%",a.currentTime=i,r.attachMedia(a),r.on(Hls.Events.MEDIA_ATTACHED,function(){r.loadSource(e.url)}),a.onseeked=function(){a.play()},a.ontimeupdate=function(e){},a.onplay=function(){n.playTimeline(t)},a.onpause=function(){n.pauseVideo()},a.onended=function(){n.pauseVideo()},n.video=a,n.videoType=zykVar.fileTypes.VIDEO,o.find(".preview-video").append(a)}}else if(e.type==zykVar.fileTypes.YOUTUBE){if(!YT)throw new Error("Youtube API is not found");o.find(".preview-video").hide(),o.find(".preview-video-youtube").show(),n.video?(n.video.loadVideoById({videoId:e.url,startSeconds:i}),n.videoType=zykVar.fileTypes.YOUTUBE):(n.video=new YT.Player("timelinerYoutube",{height:"390",width:"640",videoId:e.url,playerVars:{controls:0,start:i},events:{onReady:function(e){e.target.playVideo()},onStateChange:function(e){switch(e.data){case YT.PlayerState.PLAYING:n.playTimeline(t);break;case YT.PlayerState.PAUSED:case YT.PlayerState.ENDED:n.pauseVideo();break;case YT.PlayerState.BUFFERING:case YT.PlayerState.CUED:}}}}),n.videoType=zykVar.fileTypes.YOUTUBE)}}}pauseVideo(){const e=this;e.pauseTimeline(),e.videoType==zykVar.fileTypes.VIDEO?e.video.pause():e.videoType==zykVar.fileTypes.YOUTUBE&&e.video.pauseVideo()}updateLayers(e){const t=this,n=t.config;if(!e){e={version:1,data:{}};let t=eldraw.util.randomId();e.data[t]={index:1,id:t,label:lang["010205_76"],children:[]}}n.layers={},n.layers=e,t.render()}exportLayers(){const e=this,t=e.config;return t.layers}addLayerGroup(e,t=!1){const n=this,i=n.config;i.layers.data[e.id]=e,n.render(),t&&t()}updateLayerGroup(e,t,n=!1){const i=this,a=i.config;let l=a.layers.data[e];l&&(l.label=t,i.render(),n&&n())}async addLayer(e,t=!1){const n=this,i=n.config;if(t||(t=n.activeGroup),t){let a=await n.getLayerHighestIndex(t);-1==n.openedGroup.indexOf(t)&&n.openedGroup.push(t),e.index=a+1,i.layers.data[t]&&i.layers.data[t].children.push(e),n.render()}}async removeLayer(e){const t=this,n=t.config;let i=await t.getLayerById(e);if(i){let t=n.layers.data[i.parentId];t&&(t.children=t.children.filter(t=>t.id!=e))}}removeFloatMenu(){const e=this;$(e.element).find(".timeliner-float-menu").data("action-id")&&$(e.element).find(".timeliner-float-menu").removeData("action-id"),$(e.element).find(".timeliner-float-menu").data("condition-id")&&$(e.element).find(".timeliner-float-menu").removeData("condition-id"),$(e.element).find(".timeliner-float-menu").hide()}async addConditionOnMedia(e,t,n,i=!1){const a=this;let l=await a.getLayerByActionId(e);if(l){l.conditions||(l.conditions=[]);let e=l.conditions.find(e=>e.time==n);if(e)return;l.conditions.push({time:n,conditionId:t}),a.render(),i&&i()}}async removeMediaCondition(e,t,n=!1){const i=this;let a=await i.getLayerByActionId(t);if(a&&($(i.element).find(".timeline-media-condition-marker").each(function(){$(this).data("condition-id")==e&&$(this).remove()}),a.conditions&&a.conditions.length>0)){let t=a.conditions.findIndex(t=>t.conditionId==e);t>-1&&(a.conditions.splice(t,1),n&&n())}}}const DIALOG_NAME="zyk-dialog",DIALOG_EVENT_KEY=`${ZYK_DATA_KEY}.${DIALOG_NAME}`,DIALOG_EVENT={CLICK:`click.${DIALOG_EVENT_KEY}`,SHOW:`show.${DIALOG_EVENT_KEY}`,SHOWN:`shown.${DIALOG_EVENT_KEY}`,HIDE:`hide.${DIALOG_EVENT_KEY}`,HIDDEN:`hidden.${DIALOG_EVENT_KEY}`},DIALOG_CLASSES={BUTTON_CLOSE:"btn-close-zyk-dialog",DIALOG:"zyk-dialog"},DIALOG_SELECTOR={BUTTON_CLOSE:`.${DIALOG_CLASSES.BUTTON_CLOSE}`,DIALOG:`.${DIALOG_CLASSES.DIALOG}`},DIALOG_CONFIG_DEFAULT={popper:{placement:"bottom",offset:[0,0],flip:!0,boundary:"viewport"}};class ZykDialog{constructor(e,t,n){this.config={...DIALOG_CONFIG_DEFAULT,...n},this.element=e,this.target=t,this.isShown=!1,this.popper=null,this.prepare()}prepare(){const e=this;let t=e.config;if(!zykUtil.checkPopper())return;let n=t.buttons;if(n){for(let t=0;t<Object.keys(n).length;t++){let i=Object.keys(n)[t];$(e.element).find(i).unbind().on("click",function(){n[i]&&"function"==typeof n[i]&&n[i]()})}$(document).on(DIALOG_EVENT.CLICK,function(t){0!=$(t.target).parents(DIALOG_SELECTOR.DIALOG).length||0!=$(t.target).parents(e.target).length||$(t.target).is($(e.target))||e.hide()}).on(DIALOG_EVENT.CLICK,DIALOG_SELECTOR.BUTTON_CLOSE,function(t){t.preventDefault(),t.stopPropagation(),e.hide()})}}toggle(){const e=this;return e.isShown?e.hide():e.show()}show(){const e=this;e.popper=Popper.createPopper($(e.target)[0],$(e.element)[0],e.getPopperConfig()),$(e.element).trigger(DIALOG_EVENT.SHOW),$(e.element).addClass("show"),e.isShown=!0,$(e.element).trigger(DIALOG_EVENT.SHOWN)}hide(){const e=this;$(e.element).trigger(DIALOG_EVENT.HIDE),$(e.element).removeClass("show"),e.isShown=!1,e.popper=null,$(e.element).trigger(DIALOG_EVENT.HIDDEN)}getOffset(){const e=this;let t=e.config.offset;return"string"==typeof t&&(t.replace(","," "),t=t.split(",").map(Number)),t}getPopperConfig(){const e=this;let t={placement:e.config.popper.placement,modifiers:[{name:"offset",options:{offset:e.getOffset()}},{name:"flip",enabled:e.config.popper.flip,options:{boundary:e.config.boundary}}]};return t}}class MenuGroup{constructor(e,t){let n={classes:{header:"menu-group-header",body:"menu-group-body",item:"menu-group-item",link:"menu-group-link",collapse:"menu-group-collapse",parent:"menu-group-parent",child:"menu-group-child",iconRotate:"el-rotate-90",active:"active"},attribute:!1,onSelectItem:!1};this.config={...n,...t},this.element=e,this.body=$(this.element).find(`.${this.config.classes.body}`)[0],this.init()}init(){const e=this;$(e.element).find(`.${e.config.classes.collapse}`).unbind().on("click",function(t){t.preventDefault(),$(this).closest(`.${e.config.classes.parent}`).next().slideToggle(),$(this).find("i").toggleClass(e.config.classes.iconRotate)}),$(e.element).find(`.${e.config.classes.link}`).unbind().on("click",function(t){t.preventDefault(),$(e.body).find(`.${e.config.classes.parent}`).removeClass(e.config.classes.active),$(this).closest(`.${e.config.classes.parent}`).addClass(e.config.classes.active);let n=!1;if(e.config.attribute&&(n=$(this).data(e.config.attribute)),e.config.onSelectItem)e.config.onSelectItem(n);else{let e=$(this).attr("href");window.location.href=e}})}}const POPUP_NAME="popup",POPUP_EVENT_KEY=`${ZYK_DATA_KEY}.${POPUP_NAME}`,POPUP_CLASSNAME={SHOW:"show",HIDE:"hide",FADE:"fade",FOCUS:"focus",DARK:"dark",DIALOG:"popup-dialog",BACKDROP:"popup-backdrop",BODY:"popup-body"},POPUP_SELECTOR={DIALOG:`.${POPUP_CLASSNAME.DIALOG}`,BACKDROP:`.${POPUP_CLASSNAME.BACKDROP}`,POPUP_BODY:`.${POPUP_CLASSNAME.BODY}`,TOGGLE:'[data-toggle="popup"]',DISMISS:'[data-dismiss="popup"]'},POPUP_DEFAULT={backdrop:!0,focus:!0,keyboard:!0},POPUP_DEFAULT_TYPE={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"},POPUP_EVENT={SHOW:`show.${POPUP_EVENT_KEY}`,SHOWN:`shown.${POPUP_EVENT_KEY}`,HIDE:`hide.${POPUP_EVENT_KEY}`,HIDDEN:`hidden.${POPUP_EVENT_KEY}`,CLICK_DISMISS:`click.dismiss.${POPUP_EVENT_KEY}`,MOUSEDOWN_DISMISS:`mousedown.dismiss.${POPUP_EVENT_KEY}`,MOUSEUP_DISMISS:`mouseup.dismiss.${POPUP_EVENT_KEY}`,CLICK:`click.${POPUP_EVENT_KEY}`,KEYDOWN_DISMISS:`keydown.dismiss.${POPUP_EVENT_KEY}`,FOCUSIN:`focusin.${POPUP_EVENT_KEY}`},POPUP_VAR={BACKDROP:null,IS_SHOWN:!1,IGNOREBACKDROPCLICK:!1,IS_TRANSITION:!1,TRANSITION:100};var Popup=function(){function e(e,t){this.config=this.getConfig(t),this.backdrop=POPUP_VAR.BACKDROP,this.isShown=POPUP_VAR.IS_SHOWN,this.ignoreBackdropClick=POPUP_VAR.IGNOREBACKDROPCLICK,this.isTransition=POPUP_VAR.IS_TRANSITION,this.element=e,this.dialog=e.querySelector(POPUP_SELECTOR.DIALOG),this.hasFade=$(this.element).hasClass(POPUP_CLASSNAME.FADE)}const t=e.prototype;return t.getConfig=function(e){return e=zykUtil.configSpread(POPUP_DEFAULT,e),e},t.toggle=function(e){return this.isShown?this.hide():this.show(e)},t.show=function(e){const t=this;if(this.isShown)return;zykUtil.bodyBlock(!0);let n=$.Event(POPUP_EVENT.SHOW,{target:e});$(this.element).trigger(n),this.isShown=!0,this.keepOnViewPort(),this.setEscapeEvent(),$(this.element).one(POPUP_EVENT.CLICK_DISMISS,POPUP_SELECTOR.DISMISS,function(e){return t.hide(e)}),$(this.dialog).off(POPUP_EVENT.CLICK_DISMISS),$(this.dialog).on(POPUP_EVENT.CLICK_DISMISS,function(e){if($(t.dialog).is(e.target))return"static"==t.config.backdrop?void 0:t.hide(e)}),this.showBackdrop(function(){return t.showElement(e)})},t.hide=function(e){e&&e.preventDefault();let t=$.Event(POPUP_EVENT.HIDE);$(this.element).trigger(t),this.isShown=!1,this.hideElement()},t.showElement=function(e){const t=this;this.element.style.display="block",this.hasFade?setTimeout(function(){$(t.element).addClass(POPUP_CLASSNAME.SHOW)},POPUP_VAR.TRANSITION):$(this.element).addClass(POPUP_CLASSNAME.SHOW),null==$(this.element).attr("tabindex")&&$(this.element).attr("tabindex",-1),this.config.focus&&this.forceFocus();let n=$.Event(POPUP_EVENT.SHOWN,{target:e});$(t.element).trigger(n)},t.hideElement=function(){const e=this;$(this.element).removeClass(POPUP_CLASSNAME.SHOW),this.hasFade?setTimeout(function(){e.element.style.display="none"},POPUP_VAR.TRANSITION):this.element.style.display="none",this.removeBackdrop(),$(this.element).trigger(POPUP_EVENT.HIDDEN),zykUtil.bodyBlock(!1)},t.showBackdrop=function(e){const t=this;let n=$(this.element).hasClass(POPUP_CLASSNAME.FOCUS);this.isShown&&this.config.backdrop&&(this.backdrop=$(`<div class="${POPUP_CLASSNAME.BACKDROP}"></div>`),n&&$(this.backdrop).addClass(POPUP_CLASSNAME.FOCUS),$(this.backdrop).appendTo($("body")),this.hasFade?setTimeout(function(){$(t.backdrop).addClass(POPUP_CLASSNAME.FADE)},POPUP_VAR.TRANSITION):$(this.backdrop).addClass(POPUP_CLASSNAME.SHOW),$(this.backdrop).on(POPUP_EVENT.CLICK_DISMISS,function(e){"static"!=t.config.backdrop&&t.hide()})),e&&e()},t.removeBackdrop=function(){this.backdrop&&($(this.backdrop).remove(),this.backdrop=null)},t.keepOnViewPort=function(){let e=$(this.element).offset().top,t=window.innerHeight;if(e>t){let n=e-10*t/100;$(window).scrollTop(n)}},t.forceFocus=function(){const e=this;$(document).off(POPUP_EVENT.FOCUSIN).on(POPUP_EVENT.FOCUSIN,function(t){document!==t.target&&e.element!==t.target&&0===$(e.element).has(t.target).length&&$(e.element).focusin()})},t.setEscapeEvent=function(){const e=this;this.isShown&&this.config.keyboard?$(this.element).on(POPUP_EVENT.KEYDOWN_DISMISS,function(t){t.which===zykKeys.escape&&(t.preventDefault(),e.hide())}):this.isShown||$(this.element).off(POPUP_EVENT.KEYDOWN_DISMISS)},e.jqueryInterface=function(t,n){return this.each(function(){let i=$(this).data(POPUP_EVENT_KEY),a=zykUtil.configSpread(POPUP_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(i||(i=new e(this,a),$(this).data(POPUP_EVENT_KEY,i)),"string"==typeof t){if(void 0===i[t])throw new TypeError('No method named "'+t+'"');i[t](n)}else a.toggle&&i.show(n)})},e}();$(document).on(POPUP_EVENT.CLICK,POPUP_SELECTOR.TOGGLE,function(e){let t=$(this).data("target"),n=$(t).data(POPUP_EVENT_KEY)?"toggle":zykUtil.configSpread($(t).data(),$(this).data());"a"==this.tagName&&e.preventDefault();var i=$(t).one(POPUP_EVENT.SHOW,function(e){e.isDefaultPrevented()||i.one(POPUP_EVENT.HIDDEN,function(){})});Popup.jqueryInterface.call($(t),n,this)}),$.fn[POPUP_NAME]=Popup.jqueryInterface,$.fn[POPUP_NAME].constructor=Popup;const SLIDER_NAME="slider",SLIDER_EVENT_KEY=`${ZYK_DATA_KEY}.${SLIDER_NAME}`,SLIDER_CLASSNAME={ACTIVE:"active",ITEM:"slider-item",ITEM_ACTIVE:"slider-item.active",ITEM_PREV:"slider-item-prev",ITEM_NEXT:"slider-item-next",ITEM_PREPARE:"slider-item-prepare"},SLIDER_SELECTOR={SLIDER:`.zyk-${SLIDER_NAME}`,ITEM:`.${SLIDER_CLASSNAME.ITEM}`,ITEM_ACTIVE:`.${SLIDER_CLASSNAME.ITEM_ACTIVE}`,ITEM_NEXT:`.${SLIDER_CLASSNAME.ITEM_NEXT}`,ITEM_PREV:`.${SLIDER_CLASSNAME.ITEM_PREV}`,ITEM_FIRST:`.${SLIDER_CLASSNAME.ITEM}:first-child`,ITEM_LAST:`.${SLIDER_CLASSNAME.ITEM}:last-child`,CONTROL_NEXT:'[data-slider-control="next"]',CONTROL_PREV:'[data-slider-control="prev"]'},SLIDER_MOVEMENT={NEXT:"next",PREV:"prev"},SLIDER_DEFAULT={transition:1e3,loop:!0,autoplay:!0,indicator:!0},SLIDER_EVENT={CLICK:`click.${SLIDER_EVENT_KEY}`,SWITCH:`switch.${SLIDER_EVENT_KEY}`,SWITCHED:`switched.${SLIDER_EVENT_KEY}`};var Slider=function(){function e(e,t){this.config=this.getConfig(t),this.element=e,this.slideLength=$(this.element).find(SLIDER_SELECTOR.ITEM).length}const t=e.prototype;return t.getConfig=function(e){return e=zykUtil.configSpread(SLIDER_DEFAULT,e),e},t.getActiveSlide=function(){let e=$(this.element).find(SLIDER_SELECTOR.ITEM_ACTIVE);return e},t.autoplay=function(e){},t.getPrepare=function(e){const t=this;if("string"==typeof e){if(e==SLIDER_MOVEMENT.NEXT||e==SLIDER_MOVEMENT.PREV){let n=this.getActiveSlide();if(e==SLIDER_MOVEMENT.NEXT){if($(n).index()<t.slideLength-1)$(n).next().addClass(SLIDER_CLASSNAME.ITEM_PREPARE).addClass(SLIDER_CLASSNAME.ITEM_NEXT);else{if(1!=t.config.loop)return;$(t.element).find(SLIDER_SELECTOR.ITEM_FIRST).addClass(SLIDER_CLASSNAME.ITEM_PREPARE).addClass(SLIDER_CLASSNAME.ITEM_NEXT)}setTimeout(function(){t.switchSlide(SLIDER_MOVEMENT.NEXT)},100)}else{if(e!=SLIDER_MOVEMENT.PREV)throw new TypeError("Wrong Request");if($(n).index()>0)$(n).prev().addClass(SLIDER_CLASSNAME.ITEM_PREPARE).addClass(SLIDER_CLASSNAME.ITEM_PREV);else if(0==$(n).index()){if(1!=t.config.loop)return;$(t.element).find(SLIDER_SELECTOR.ITEM_LAST).addClass(SLIDER_CLASSNAME.ITEM_PREPARE).addClass(SLIDER_CLASSNAME.ITEM_PREV)}setTimeout(function(){t.switchSlide(SLIDER_MOVEMENT.PREV)},100)}}}else if("number"==typeof e&&e<0)throw new TypeError("Wrong Request")},t.getSliderId=function(e){let t=$(e).closest(".slider");return t},t.next=function(e){let t=$.Event(SLIDER_EVENT.SWITCH,{target:e});$(this.element).trigger(t),this.getPrepare(SLIDER_MOVEMENT.NEXT)},t.prev=function(e){let t=$.Event(SLIDER_EVENT.SWITCH,{target:e});$(this.element).trigger(t),this.getPrepare(SLIDER_MOVEMENT.PREV)},t.switchSlide=function(e,t){let n=this.getActiveSlide();if(n.removeClass(SLIDER_CLASSNAME.ACTIVE),"string"==typeof e)if(e==SLIDER_MOVEMENT.NEXT){let e=$(this.element).find(SLIDER_SELECTOR.ITEM_NEXT);e.removeClass(SLIDER_CLASSNAME.ITEM_NEXT).removeClass(SLIDER_CLASSNAME.ITEM_PREPARE).addClass(SLIDER_CLASSNAME.ACTIVE)}else if(e==SLIDER_MOVEMENT.PREV){let e=$(this.element).find(SLIDER_SELECTOR.ITEM_PREV);e.removeClass(SLIDER_CLASSNAME.ITEM_PREV).removeClass(SLIDER_CLASSNAME.ITEM_PREPARE).addClass(SLIDER_CLASSNAME.ACTIVE)}let i=$.Event(SLIDER_EVENT.SWITCHED,{target:t});$(this.element).trigger(i),this.setControlVisible()},t.setControlVisible=function(){!1===this.config.loop&&($(this.getActiveSlide()).index()==this.slideLength-1?$(this.element).find(SLIDER_SELECTOR.CONTROL_NEXT).hide():$(this.element).find(SLIDER_SELECTOR.CONTROL_NEXT).show(),0==$(this.getActiveSlide()).index()?$(this.element).find(SLIDER_SELECTOR.CONTROL_PREV).hide():$(this.element).find(SLIDER_SELECTOR.CONTROL_PREV).show())},e.jqueryInterface=function(t,n){return this.each(function(){let i=$(this).data(SLIDER_EVENT_KEY),a=zykUtil.configSpread(SLIDER_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(i||(i=new e(this,a),$(this).data(SLIDER_EVENT_KEY,i)),"string"==typeof t){if(void 0===i[t])throw new TypeError('No method named "'+t+'"');i[t](n)}else i.config.autoplay&&i.autoplay(n)})},e}();$(document).on(SLIDER_EVENT.CLICK,SLIDER_SELECTOR.CONTROL_NEXT,function(e){let t=$(this).data("target"),n=$(t).data(SLIDER_EVENT_KEY)?$(t).data(SLIDER_EVENT_KEY):zykUtil.configSpread($(t).data(),$(this).data());"A"==this.tagName&&e.preventDefault();let i=$(t).data(SLIDER_EVENT_KEY);i.next(t),Slider.jqueryInterface.call($(t),n,this)}),$(document).on(SLIDER_EVENT.CLICK,SLIDER_SELECTOR.CONTROL_PREV,function(e){let t=$(this).data("target"),n=$(t).data(SLIDER_EVENT_KEY)?$(t).data(SLIDER_EVENT_KEY):zykUtil.configSpread($(t).data(),$(this).data());"A"==this.tagName&&e.preventDefault();let i=$(t).data(SLIDER_EVENT_KEY);i.prev(t),Slider.jqueryInterface.call($(t),n,this)}),$.fn[SLIDER_NAME]=Slider.jqueryInterface,$.fn[SLIDER_NAME].constructor=Slider;const FILTER_NAME="filterexpand",FILTER_EVENT_KEY=`${ZYK_DATA_KEY}.${FILTER_NAME}`,FILTER_CLASSNAME={WRAPPER:"view-body-filter",BUTTON_DEFAULT:"elo",BUTTON_ACTIVE:"els"},FILTER_SELECTOR={WRAPPER:`.${FILTER_CLASSNAME.WRAPPER}`,TOGGLE:'[data-toggle="filter"]',ICON:"i"},FILTER_EVENT={CLICK:`click.${FILTER_EVENT_KEY}`,SHOW:`show.${FILTER_EVENT_KEY}`,SHOWN:`shown.${FILTER_EVENT_KEY}`,HIDE:`hide.${FILTER_EVENT_KEY}`,HIDDEN:`hidden.${FILTER_EVENT_KEY}`},FILTER_DEFAULT={IS_SHOWN:!1};var Filter=function(){function e(e,t){this.config=this.getConfig(t),this.element=e,this.is_shown=FILTER_DEFAULT.IS_SHOWN}const t=e.prototype;return t.getConfig=function(e){return e=zykUtil.configSpread(FILTER_DEFAULT,e),e},t.toggle=function(e){return this.is_shown?this.hide(e):this.show(e)},t.show=function(e){let t=$.Event(FILTER_EVENT.SHOW,{target:e});$(this.element).trigger(t),$(this.element).slideDown(),$(this.element).trigger(FILTER_EVENT.SHOWN),$(e).find(FILTER_SELECTOR.ICON).removeClass(FILTER_CLASSNAME.BUTTON_DEFAULT).addClass(FILTER_CLASSNAME.BUTTON_ACTIVE),this.is_shown=!0},t.hide=function(e){$(this.element).trigger(FILTER_EVENT.HIDE),$(this.element).slideUp(),$(this.element).trigger(FILTER_EVENT.HIDDEN),$(e).find(FILTER_SELECTOR.ICON).removeClass(FILTER_CLASSNAME.BUTTON_ACTIVE).addClass(FILTER_CLASSNAME.BUTTON_DEFAULT),this.is_shown=!1},e.jqueryInterface=function(t,n){return this.each(function(){let i=$(this).data(FILTER_EVENT_KEY),a=zykUtil.configSpread(FILTER_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(i||(i=new e(this,a),$(this).data(FILTER_EVENT_KEY,i),$(n).find("i").hasClass("els")&&(i.is_shown=!0)),"string"==typeof t){if(void 0===i[t])throw new TypeError('No method named "'+t+'"');i[t](n)}else a.toggle&&i.toggle(n)})},e}();$(document).on(FILTER_EVENT.CLICK,FILTER_SELECTOR.TOGGLE,function(e){let t=$(this).data("target"),n=$(t).data(FILTER_EVENT_KEY)?"toggle":zykUtil.configSpread($(t).data(),$(this).data());"a"==this.tagName&&e.preventDefault(),Filter.jqueryInterface.call($(t),n,this)}),$.fn[FILTER_NAME]=Filter.jqueryInterface,$.fn[FILTER_NAME].constructor=Filter;const CHECK_NAME="check",CHECK_EVENT_KEY=`${ZYK_DATA_KEY}.${CHECK_NAME}`,CHECK_TYPE={CHECKBOX:"checkbox",RADIO:"radio",SWITCH:"switch"},CHECK_EVENT={CLICK:`click.${CHECK_EVENT_KEY}`,CHECK:`check.${CHECK_EVENT_KEY}`,UNCHECK:`uncheck.${CHECK_EVENT_KEY}`,CHANGE:`change.${CHECK_EVENT_KEY}`},CHECK_DEFAULT={},CHECK_SELECTOR={TOGGLE:'[data-toggle="check"]',ICON:"i"};var Check=function(){function e(e,t){this.config=this.getConfig(t),this.element=e,this.input=$(this.element).siblings("input"),this.type=$(this.element).data("type"),this.disabled=$(this.input).prop("disabled")}const t=e.prototype;return t.getConfig=function(e){return e=zykUtil.configSpread(CHECK_DEFAULT,e),e},t.toggle=function(){const e=this;if(!e.disabled){let t=e.input.prop("checked");return t?e.uncheck():e.check()}},t.check=function(){const e=this;switch(e.type){case CHECK_TYPE.CHECKBOX:e.input.prop("checked",!0),$(e.element).find(CHECK_SELECTOR.ICON).removeClass("elo el-square-rounded").addClass("els el-check-square");break;case CHECK_TYPE.SWITCH:e.input.prop("checked",!0),$(e.element).find(".btn-switch").addClass("active");break;case CHECK_TYPE.RADIO:$(e.element).closest(".form-check-group").find(CHECK_SELECTOR.ICON).removeClass("els el-check-circle").addClass("elo el-circle"),$(e.element).closest(".form-check-group").find('input[type="radio"]').prop("checked",!1),$(e.element).find(CHECK_SELECTOR.ICON).removeClass("elo el-circle").addClass("els el-check-circle"),$(e.element).siblings('input[type="radio"]').prop("checked",!0)}$(e.element).trigger(CHECK_EVENT.CHANGE),$(e.element).trigger(CHECK_EVENT.CHECK)},t.uncheck=function(){const e=this;switch(e.type){case CHECK_TYPE.CHECKBOX:e.input.prop("checked",!1),$(e.element).find(CHECK_SELECTOR.ICON).removeClass("els el-check-square").addClass("elo el-square-rounded");break;case CHECK_TYPE.SWITCH:e.input.prop("checked",!1),$(e.element).find(".btn-switch").removeClass("active");break;case CHECK_TYPE.RADIO:}$(e.element).trigger(CHECK_EVENT.CHANGE),$(e.element).trigger(CHECK_EVENT.UNCHECK)},t.toggleIcon=function(){const e=this;let t=e.input.prop("checked");switch(e.type){case CHECK_TYPE.CHECKBOX:t?(e.input.prop("checked",!1),$(e.element).find(CHECK_SELECTOR.ICON).removeClass("els el-check-square").addClass("elo el-square-rounded")):(e.input.prop("checked",!0),$(e.element).find(CHECK_SELECTOR.ICON).removeClass("elo el-square-rounded").addClass("els el-check-square"));break;case CHECK_TYPE.SWITCH:t?(e.input.prop("checked",!1),$(e.element).find(".btn-switch").removeClass("active")):(e.input.prop("checked",!0),$(e.element).find(".btn-switch").addClass("active"));break;case CHECK_TYPE.RADIO:t?($(e.element).find(CHECK_SELECTOR.ICON).removeClass("els el-check-circle").addClass("elo el-circle"),$(e.element).siblings('input[type="radio"]').prop("checked",!1)):($(e.element).find(CHECK_SELECTOR.ICON).removeClass("elo el-circle").addClass("els el-check-circle"),$(e.element).siblings('input[type="radio"]').prop("checked",!0))}},e.jqueryInterface=function(t,n){return this.each(function(){let n=$(this).data(CHECK_EVENT_KEY),i=zykUtil.configSpread(CHECK_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(n||(n=new e(this,i),$(this).data(CHECK_EVENT_KEY,n)),"string"==typeof t){if(void 0===n[t])throw new TypeError('No method named "'+t+'"');n[t]()}else i.toggle&&n.toggle()})},e}();$(document).on(CHECK_EVENT.CLICK,CHECK_SELECTOR.TOGGLE,function(e){let t=$(this).data(CHECK_EVENT_KEY)?"toggle":$(this).data();"a"==this.tagName&&e.preventDefault(),$(this).attr("disabled")||Check.jqueryInterface.call($(this),t,this)}),$.fn[CHECK_NAME]=Check.jqueryInterface,$.fn[CHECK_NAME].constructor=Check;let SELECT_NAME="zykselect",SELECT_EVENT_KEY=`${ZYK_DATA_KEY}.${SELECT_NAME}`,SELECT_DEFAULT={data:{},selected:-1,searchPlaceholder:"Search...",resetSearchLabel:"Reset",disableSearch:!1,arrowUp:"elo el-caret-up",arrowDown:"elo el-caret-down",defaultLabel:"Select one",menuRight:!1,onSelect:!1,onSearch:!1,onResetSearch:!1},SELECT_EVENT={INIT:`init.${SELECT_EVENT_KEY}`,CLICK:`click.${SELECT_EVENT_KEY}`,SELECT:`select.${SELECT_EVENT_KEY}`,CHANGE:`change.${SELECT_EVENT_KEY}`,SEARCH:`search.${SELECT_EVENT_KEY}`,RESET_SEARCH:`resetsearch.${SELECT_EVENT_KEY}`,SHOW:`show.${SELECT_EVENT_KEY}`,SHOWN:`shown.${SELECT_EVENT_KEY}`,HIDE:`hide.${SELECT_EVENT_KEY}`,HIDDEN:`hidden.${SELECT_EVENT_KEY}`},SELECT_CLASS={WRAPPER:"zyk-select-wrapper",TOGGLE:"zyk-select-btn",TOGGLE_LABEL:"zyk-select-label",MENU:"zyk-select-menu",MENU_HEADER:"zyk-select-menu-header",MENU_BODY:"zyk-select-menu-body",SEARCH_INPUT:"zyk-select-menu-search",SEARCH_BUTTON:"zyk-select-menu-search-button",SEARCH_RESET:"zyk-select-menu-reset-search",SHOW:"show",LIST_ITEM_LABEL:"zyk-select-item-label"},SELECT_SELECTOR={WRAPPER:`.${SELECT_CLASS.WRAPPER}`,TOGGLE:'[data-toggle="select"]',TOGGLE_LABEL:`.${SELECT_CLASS.TOGGLE_LABEL}`,TOGGLE_ICON:"i",MENU:`.${SELECT_CLASS.MENU}`,MENU_HEADER:`.${SELECT_CLASS.MENU_HEADER}`,MENU_BODY:`.${SELECT_CLASS.MENU_BODY}`,SEARCH_INPUT:`.${SELECT_CLASS.SEARCH_INPUT}`,SEARCH_BUTTON:`.${SELECT_CLASS.SEARCH_BUTTON}`,SEARCH_RESET:`.${SELECT_CLASS.SEARCH_RESET}`,LIST:"ul",LIST_ITEM:"li",LIST_ITEM_LABEL:`.${SELECT_CLASS.LIST_ITEM_LABEL}`},Select=function(){function e(e,t){this.config=this.getConfig(t),this.element=e,this.parent=this.element.parentElement,this.menu=this.parent.querySelector(SELECT_SELECTOR.MENU),this.toggleLabel=this.parent.querySelector(SELECT_SELECTOR.TOGGLE_LABEL),this.onSelect=this.config.onSelect,this.selected=this.config.selected,this.isShown=!1}const t=e.prototype;return t.getConfig=function(e){let t={};return t={...SELECT_DEFAULT,...e},t},t.getValue=function(){const e=this;return $(e.element).val()},t.init=function(e){const t=this;if($(t.parent).find(SELECT_SELECTOR.MENU).remove(),$(t.parent).append(t.generateMenu(e)),-1!=t.selected){let n=t.checkSelected(e);void 0!==n?($(t.toggleLabel).text(n.label),
$(t.element).data("selected-item",n)):($(t.toggleLabel).text(t.config.defaultLabel),$(t.element).removeData("selected-item")),$(t.element).data("selected",t.selected)}t.initSearch(),$(t.parent).trigger(SELECT_EVENT.INIT)},t.generateMenu=function(e){const t=this;let n=!1;n=e.length>0?t.generateChild(e):$('<p class="p-overline no-data">No data</p>');let i=$(`\n            <div class="zyk-select-menu ${t.config.menuRight?"zyk-select-menu-right":""}">\n                <div class="zyk-select-menu-header">\n                    ${(()=>t.config.disableSearch?"":`\n                                <div class="input-group input-group-sm">\n                                    <span class="input-group-text">\n                                        <i class="elo el-search"></i>\n                                    </span>\n\n                                    <input type="search" class="form-control zyk-select-menu-search" placeholder="${t.config.searchPlaceholder}">\n                                </div>`)()}\n\n                    <button class="btn btn-sm btn-outline-default zyk-select-menu-reset-search" type="button">\n                        <i class="elo el-lg el-undo"></i> ${t.config.disableSearch?t.config.resetSearchLabel:""}\n                    </button>\n                </div>\n\n                <div class="zyk-select-menu-body"></div>\n            </div>\n        `);return n&&(i.find(SELECT_SELECTOR.MENU_BODY).empty(),i.find(SELECT_SELECTOR.MENU_BODY).append(n)),i[0]},t.generateChild=function(e,t=0){const n=this;let i=$(`<ul style="--level: ${t}"></ul>`);return e.forEach(e=>{let a=$("<li></li>"),l=$(`\n                <a href="#" class="zyk-select-item-label">\n                   ${e.label.escapeXSS()}\n                </a>\n            `);if(l.unbind().on("click",function(){n.selected=e.id,n.change(e.label),$(n.element).data("selected",e.id),$(n.parent).trigger(SELECT_EVENT.SELECT),n.onSelect&&n.onSelect(e.id,e)}),a.append(l),e.subgroup&&e.subgroup.length>0){let i=e.subgroup,l=n.generateChild(i,t+1);a.append(l)}i.append(a)}),i},t.checkSelected=function(e){const t=this;let n;return n=e.find(e=>e.id==t.selected),void 0===n&&e.forEach(e=>{void 0===n&&e.subgroup&&(n=t.checkSelected(e.subgroup))}),n},t.toggle=function(){const t=this;let n=$(t.menu).hasClass(SELECT_CLASS.SHOW);e.clearMenus(),n||t.show()},t.show=function(){const e=this;$(e.parent).find(SELECT_SELECTOR.SEARCH_INPUT).val(""),$(e.parent).find(SELECT_SELECTOR.LIST_ITEM).show(),e.isShown=!0,$(e.parent).trigger(SELECT_EVENT.SHOW),$(e.menu).addClass(SELECT_CLASS.SHOW),$(e.element).find(SELECT_SELECTOR.TOGGLE_ICON).removeClass(e.config.arrowDown).addClass(e.config.arrowUp),$(e.parent).trigger(SELECT_EVENT.SHOWN)},t.hide=function(){const e=this;e.isShown=!1,$(e.parent).trigger(SELECT_EVENT.HIDE),$(e.menu).removeClass(SELECT_CLASS.SHOW),$(e.element).find(SELECT_SELECTOR.TOGGLE_ICON).removeClass(e.config.arrowUp).addClass(e.config.arrowDown),$(e.parent).trigger(SELECT_EVENT.HIDDEN)},t.change=function(e){const t=this;$(t.element).find(SELECT_SELECTOR.TOGGLE_LABEL).text(e),$(t.parent).trigger(SELECT_EVENT.CHANGE)},t.initSearch=function(){const e=this;$(e.parent).unbind().on(SELECT_EVENT.CLICK,SELECT_SELECTOR.SEARCH_RESET,function(){$(e.parent).find(SELECT_SELECTOR.SEARCH_INPUT).val(""),e.config.onResetSearch?e.config.onResetSearch():(e.change(e.config.defaultLabel),e.selected=-1),$(e.parent).trigger(SELECT_EVENT.RESET_SEARCH)}).on(SELECT_EVENT.SEARCH,SELECT_SELECTOR.SEARCH_INPUT,function(){let t=$(this).val();t=zykUtil.convertSlug(t),$(e.parent).find(SELECT_SELECTOR.LIST_ITEM).filter(function(){$(this).toggle(zykUtil.convertSlug($(this).find(SELECT_SELECTOR.LIST_ITEM_LABEL).text()).indexOf(t)>-1)})})},e.jqueryInterface=function(t="init"){return this.each(function(){let n=$(this).data(SELECT_EVENT_KEY);n&&$(this).removeData(SELECT_EVENT_KEY);let i=zykUtil.configSpread(SELECT_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(n=new e(this,i),$(this).data(SELECT_EVENT_KEY,n),"string"==typeof t){if(void 0===n[t])throw new TypeError(`No method named ${t}`);n[t]()}else"object"==typeof t&&n.init(t.data)})},e}();Select.clearMenus=function(e){let t=[].slice.call(document.querySelectorAll(SELECT_SELECTOR.TOGGLE));for(let n=0;n<t.length;n++){let i=$(t[n]).parent(),a=$(t[n]).data(SELECT_EVENT_KEY);if($(i).trigger(SELECT_EVENT.HIDE),!a)continue;let l=a.menu;$(l).hasClass(SELECT_CLASS.SHOW)&&(e&&"click"===e.type&&/input|textarea|select/i.test(e.target.tagName)||(a.isShown=!1,$(i).find(SELECT_SELECTOR.TOGGLE_ICON).removeClass(a.config.arrowUp).addClass(a.config.arrowDown),$(l).removeClass(SELECT_CLASS.SHOW),$(i).trigger(SELECT_EVENT.HIDDEN)))}},$(document).on(SELECT_EVENT.CLICK,Select.clearMenus).on(SELECT_EVENT.CLICK,SELECT_SELECTOR.TOGGLE,function(e){e.preventDefault(),e.stopPropagation(),Select.jqueryInterface.call($(this),"toggle",this)}),$.fn[SELECT_NAME]=Select.jqueryInterface,$.fn[SELECT_NAME].constructor=Select;let SELECT2_NAME="zykselect2",SELECT2_EVENT_KEY=`${ZYK_DATA_KEY}.${SELECT2_NAME}`,SELECT2_DEFAULT={searchPlaceholder:`${lang["000100_25"]}...`},SELECT2_EVENT={INIT:`init.${SELECT2_EVENT_KEY}`,CLICK:`click.${SELECT2_EVENT_KEY}`,SELECT:`select.${SELECT2_EVENT_KEY}`,CHANGE:`change.${SELECT2_EVENT_KEY}`,SEARCH:`search.${SELECT2_EVENT_KEY}`,RESET_SEARCH:`resetsearch.${SELECT2_EVENT_KEY}`,BLUR_INPUT:`blur.${SELECT2_EVENT_KEY}`,EDIT_INPUT:`editinput.${SELECT2_EVENT_KEY}`,CLICK_ADDITION_BUTTON:`clickaddtionbutton.${SELECT2_EVENT_KEY}`,SHOW:`show.${SELECT2_EVENT_KEY}`,SHOWN:`shown.${SELECT2_EVENT_KEY}`,HIDE:`hide.${SELECT2_EVENT_KEY}`,HIDDEN:`hidden.${SELECT2_EVENT_KEY}`},SELECT2_CLASS={WRAPPER:"zyk-select-2-wrapper",WRAPPER_ITEM:"zyk-select-2-item",MENU:"zyk-select-2-menu",MENU_HEADER:"zyk-select-2-menu-header",MENU_BODY:"zyk-select-2-menu-body",SEARCH_INPUT:"zyk-select-2-menu-search",SEARCH_BUTTON:"zyk-select-2-menu-search-button",SEARCH_RESET:"zyk-select-2-menu-reset-search",SHOW:"show",GET_VALUE:"zyk-select-2-get-value"},SELECT2_SELECTOR={TOGGLE:'[data-toggle="zykselect2"]',DISMISS:'[data-dismiss="zyk-select-2-item"]',WRAPPER:`.${SELECT2_CLASS.WRAPPER}`,WRAPPER_ITEM:`.${SELECT2_CLASS.WRAPPER_ITEM}`,MENU:`.${SELECT2_CLASS.MENU}`,MENU_HEADER:`.${SELECT2_CLASS.MENU_HEADER}`,MENU_BODY:`.${SELECT2_CLASS.MENU_BODY}`,SEARCH_INPUT:`.${SELECT2_CLASS.SEARCH_INPUT}`,SEARCH_BUTTON:`.${SELECT2_CLASS.SEARCH_BUTTON}`,SEARCH_RESET:`.${SELECT2_CLASS.SEARCH_RESET}`,GET_VALUE:`.${SELECT2_CLASS.GET_VALUE}`,OPTGROUP:"optgroup",OPTION:"option"},Select2=function(){function e(e,t){this.config=this.getConfig(t),this.element=e,this.parent=this.element.parentElement.parentElement,this.wrapper=this.parent.querySelector(SELECT2_SELECTOR.WRAPPER),this.menu=this.parent.querySelector(SELECT2_SELECTOR.MENU),this.selected={},this.isShown=!1}const t=e.prototype;return t.getConfig=function(e){return e=zykUtil.configSpread(SELECT2_DEFAULT,e),e},t.toggle=function(){const t=this;let n=$(t.menu).hasClass(SELECT2_CLASS.SHOW);e.clearMenus(),n||t.show()},t.show=function(){const e=this;$(e.menu).addClass(SELECT2_CLASS.SHOW),$(e.parent).trigger(SELECT2_EVENT.SHOWN),this.isShown=!0,this.initActions()},t.hide=function(){const e=this;$(e.menu).removeClass(SELECT2_CLASS.SHOW),$(e.parent).trigger(SELECT2_EVENT.HIDDEN),this.isShown=!1},t.initActions=function(){const e=this;$(e.menu).find(SELECT2_SELECTOR.GET_VALUE).unbind().on("click",function(t){t.preventDefault();let n=$(this).data("value"),i=$(this).text().trim();e.config.selectSingle?(e.selected=[],e.selected.push({name:i,value:n}),e.config.input&&(e.selected[0].input=""),e.config.button&&(e.selected[0].button={label:e.config.button,value:""})):(void 0===e.selected[n]&&(e.selected[n]={name:i,value:n}),e.config.input&&(e.selected[n].input=""),e.config.button&&(e.selected[n].button={label:e.config.button,value:""})),e.hide(),e.updateWrapper()}),$(e.menu).on(SELECT2_EVENT.SEARCH,SELECT2_SELECTOR.SEARCH_INPUT,function(){let t=$(this).val();t=zykUtil.convertSlug(t),$(e.parent).find(SELECT2_SELECTOR.GET_VALUE).filter(function(){$(this).parent().toggle(zykUtil.convertSlug($(this).text()).indexOf(t)>-1)}),$(e.parent).trigger(SELECT2_EVENT.SEARCH)}),$(e.menu).on(SELECT_EVENT.CLICK,SELECT2_SELECTOR.SEARCH_RESET,function(){$(e.menu).find(SELECT2_SELECTOR.SEARCH_INPUT).val(""),$(e.menu).find(SELECT2_SELECTOR.SEARCH_INPUT).trigger(SELECT2_EVENT.SEARCH)})},t.updateWrapper=function(){const e=this;$(e.wrapper).find(SELECT2_SELECTOR.WRAPPER_ITEM).remove(),$.each(e.selected,(t,n)=>{let i=e.generateItem(n);i.insertBefore($(e.wrapper).find(SELECT2_SELECTOR.TOGGLE))}),$(e.parent).trigger(SELECT2_EVENT.CHANGE,[e.selected])},t.generateItem=function(e){const t=this;let n=$('<div class="zyk-select-2-item"></div>');return n.append(`\n            <p class="p-sm">\n                ${e.name}\n            </p>\n        `),void 0!==e.input&&(""!=e.input?n.append(`\n                    <div class="input-wrapper">\n                        <div class="input-overlay"></div>\n                        <input type="text" class="form-control disabled" value="${e.input}" disabled>\n                    </div>\n                `):n.append('\n                    <div class="input-wrapper">\n                        <div class="input-overlay"></div>\n                        <input type="text" class="form-control disabled" value="Text" disabled>\n                    </div>\n                ')),void 0!==e.button&&n.append(`\n                <button class="btn btn-addition-button" type="button">\n                    ${e.button.label}\n                </button>\n            `),n.append('\n            <button class="btn" data-dismiss="zyk-select-2-item" type="button">\n                <i class="elo el-lg el-close"></i>\n            </button>\n        '),n.unbind().on(SELECT2_EVENT.CLICK,".input-overlay",function(){let e=$(this).siblings("input").attr("disabled");e?($(this).hide(),$(this).siblings("input").removeAttr("disabled"),$(this).siblings("input").removeClass("disabled")):($(this).show(),$(this).siblings("input").attr("disabled",!0),$(this).siblings("input").addClass("disabled"),$(this).siblings("input").focus())}).on(SELECT2_EVENT.BLUR_INPUT,"input",function(){let n=t.selected.find(t=>e.value==t.value);n.input=$(this).val(),$(this).siblings(".input-overlay").show(),$(this).attr("disabled",!0),$(this).addClass("disabled")}).on(SELECT2_EVENT.EDIT_INPUT,"input",function(){$(this).trigger(SELECT2_EVENT.BLUR_INPUT)}).on(SELECT2_EVENT.CLICK,".btn-addition-button",function(){$(t.parent).trigger(SELECT2_EVENT.CLICK_ADDITION_BUTTON,[this])}).on(SELECT2_EVENT.CLICK,SELECT2_SELECTOR.DISMISS,function(){n.remove();t.selected.find(t=>e.value==t.value);$(t.parent).trigger(SELECT2_EVENT.CHANGE,[t.selected])}),n},e.jqueryInterface=function(t){return this.each(function(){let n=$(this).data(SELECT2_EVENT_KEY),i=zykUtil.configSpread(SELECT2_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(n||(n=new e(this,i),$(this).data(SELECT2_EVENT_KEY,n)),"string"==typeof t){if(void 0===n[t])throw new TypeError(`No method named ${t}`);n[t]()}else"object"==typeof t&&Object.keys(t).length>0&&Object.keys(t).forEach(e=>{"selected"===e&&(n.selected=t[e],n.updateWrapper())})})},e.clearMenus=function(e){let t=[].slice.call(document.querySelectorAll(SELECT2_SELECTOR.TOGGLE));for(let n=0;n<t.length;n++){let i=$(t[n]).parent(),a=$(t[n]).data(SELECT2_EVENT_KEY);if(!a)continue;let l=a.menu;$(l).hasClass(SELECT2_CLASS.SHOW)&&(e&&"click"===e.type&&/input|textarea|select/i.test(e.target.tagName)||(a.isShown=!1,$(l).removeClass(SELECT2_CLASS.SHOW),$(i).trigger(SELECT2_EVENT.HIDDEN)))}},e}();$(document).on(SELECT2_EVENT.CLICK,Select2.clearMenus).on(SELECT2_EVENT.CLICK,SELECT2_SELECTOR.TOGGLE,function(e){e.preventDefault(),e.stopPropagation(),Select2.jqueryInterface.call($(this),"toggle",this)}),$.fn[SELECT2_NAME]=Select2.jqueryInterface,$.fn[SELECT2_NAME].constructor=Select2;let TYPE_SUGGEST_NAME="zyktypesuggest",TYPE_SUGGEST_EVENT_KEY=`${ZYK_DATA_KEY}.${TYPE_SUGGEST_NAME}`,TYPE_SUGGEST_KEYCODE={ENTER:13,TAB:9},TYPE_SUGGEST_EVENT={CLICK:`click.${TYPE_SUGGEST_EVENT_KEY}`,INPUT:`input.${TYPE_SUGGEST_EVENT_KEY}`,KEYUP:`keyup.${TYPE_SUGGEST_EVENT_KEY}`,CHANGE:`change.${TYPE_SUGGEST_EVENT_KEY}`,SEARCH:`search.${TYPE_SUGGEST_EVENT_KEY}`,RESET_SEARCH:`restsearch.${TYPE_SUGGEST_EVENT_KEY}`,SELECT:`selectitem.${TYPE_SUGGEST_EVENT_KEY}`,FOCUS:`focus.${TYPE_SUGGEST_EVENT_KEY}`,BLUR:`blur.${TYPE_SUGGEST_EVENT_KEY}`},TYPE_SUGGEST_CLASS={INPUT:"zyk-type-suggest",MENU:"zyk-type-suggest-menu",MENU_ITEM:"zyk-type-suggest-menu-item",SHOW:"show"},TYPE_SUGGEST_SELECTOR={INPUT:`.${TYPE_SUGGEST_CLASS.INPUT}`,MENU:`.${TYPE_SUGGEST_CLASS.MENU}`,MENU_ITEM:`.${TYPE_SUGGEST_CLASS.MENU_ITEM}`},TYPE_SUGGEST_PLACEMENT={DOWN:"bottom-start",DOWNEND:"bottom-end",UP:"top-start",UPEND:"top-end",LEFT:"left-start",RIGHT:"right-start"},TYPE_SUGGEST_DEFAULT={queryUrl:"",placement:TYPE_SUGGEST_PLACEMENT.DOWN,flip:!0,offset:[0,0],boundary:"viewport",labelNoData:"No data"},Typesuggest=function(){function e(e,t){this.config=this.getConfig(t),this.popper=null,this.menu=null,this.isShowMenu=!1,this.isRequestingAjax=!1,this.timeOutQuery=null,this.element=e}const t=e.prototype;return t.getConfig=function(e){return e=zykUtil.configSpread(TYPE_SUGGEST_DEFAULT,e),e},t.fire=function(){console.log("fire")},t.select=function(e){const t=this;$(t.element).trigger(TYPE_SUGGEST_EVENT.SELECT,e)},t.search=function(){const t=this;e.clearMenus();let n=$(t.element).val();if(!(n.trim().length>0))return t.resetSearch();$(t.element).trigger(TYPE_SUGGEST_EVENT.SEARCH,n)},t.resetSearch=function(){const t=this;e.clearMenus(),$(t.element).trigger(TYPE_SUGGEST_EVENT.RESET_SEARCH)},t.querySearch=function(){const e=this;e.timeOutQuery&&clearTimeout(e.timeOutQuery),e.timeOutQuery=setTimeout(()=>{e.isRequestingAjax||e.queryAjax(t=>{e.getSuggestList(t)})},300)},t.queryAjax=function(e){const t=this;let n=null,i=t.config.queryUrl,a=$(t.element).val();if(!(a.trim().length>0))return t.resetSearch();i=zykUtil.buildUrl(i,"q",a),$.ajax({url:i,type:"GET",dataType:"json",data:{},beforeSend:()=>{t.isRequestingAjax=!0},success:i=>{if(t.isRequestingAjax=!1,i.length>0){n=[];for(let e=0;e<i.length;e++)n.push(i[e])}e(n)},error:()=>{e(n)}})},t.getSuggestList=function(e){const t=this;e&&Array.isArray(e)||(e=[]),t.getSuggestMenu(e)},t.getSuggestMenu=function(t){const n=this;let i,a=$(n.element).val();e.clearMenus(),zykUtil.checkPopper()&&(n.menu=document.createElement("div"),n.menu.classList.add("zyk-type-suggest-menu"),n.popper=Popper.createPopper(n.element,n.menu,n.getPopperConfig()),i=$(n.menu),t.length>0?t.forEach(t=>{let l=$(`\n                    <a href="#" class="zyk-type-suggest-menu-item">\n                        ${zykUtil.replaceAll(t,a,`<b>${a}</b>`)}\n                    </a>\n                `);l.unbind().on("click",function(){return e.clearMenus(),n.select(t)}),i.append(l)}):i.append(`\n              <a href="javascript:void(0);" class="zyk-type-suggest-menu-item disabled">\n                    ${n.config.labelNoData}\n                </a>\n            `),$("body").append(i),i.css({width:$(n.element).width()}),i.addClass("show"),n.isShowMenu=!0)},t.getOffset=function(){const e=this;let t=e.config.offset;return"string"==typeof t&&(t.replace(","," "),t=t.split(",").map(Number)),t},t.getPlacement=function(){const e=this;let t=e.config.placement;return t},t.getPopperConfig=function(){const e=this;let t={placement:e.getPlacement(),modifiers:[{name:"offset",options:{offset:e.getOffset()}},{name:"flip",enabled:e.config.flip,options:{boundary:e.config.boundary}}]};return t},e.jqueryInterface=function(t){return this.each(function(){let n=$(this).data(TYPE_SUGGEST_EVENT_KEY),i=zykUtil.configSpread(TYPE_SUGGEST_DEFAULT,$(this).data(),"object"==typeof t&&t?t:{});if(n||(n=new e(this,i),$(this).data(TYPE_SUGGEST_EVENT_KEY,n)),"string"==typeof t){if(void 0===n[t])throw new TypeError(`No method named ${t}`);n[t]()}})},e.clearMenus=function(){let e=[].slice.call(document.querySelectorAll(TYPE_SUGGEST_SELECTOR.INPUT));for(let t=0;t<e.length;t++){let n=$(e[t]).data(TYPE_SUGGEST_EVENT_KEY);if(!n)continue;let i=n.menu;$(i).hasClass(TYPE_SUGGEST_CLASS.SHOW)&&(event&&"click"===event.type&&/input|textarea|select/i.test(event.target.tagName)||(n.popper&&n.popper.destroy(),n.isShowMenu=!1,$(i).removeClass(TYPE_SUGGEST_CLASS.SHOW),$(i).remove()))}},e}();$(document).on(TYPE_SUGGEST_EVENT.CLICK,Typesuggest.clearMenus).on(TYPE_SUGGEST_EVENT.KEYUP,TYPE_SUGGEST_SELECTOR.INPUT,function(e){if(e.keyCode===TYPE_SUGGEST_KEYCODE.ENTER)return Typesuggest.jqueryInterface.call($(this),"search"),void Typesuggest.clearMenus();e.keyCode!==TYPE_SUGGEST_KEYCODE.TAB?Typesuggest.jqueryInterface.call($(this),"querySearch"):Typesuggest.clearMenus()}).on(TYPE_SUGGEST_EVENT.FOCUS,TYPE_SUGGEST_SELECTOR.INPUT,function(){Typesuggest.clearMenus()}),$.fn[TYPE_SUGGEST_NAME]=Typesuggest.jqueryInterface,$.fn[TYPE_SUGGEST_NAME].constructor=Typesuggest;